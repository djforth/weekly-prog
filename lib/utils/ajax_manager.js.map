{"version":3,"sources":["../../src/utils/ajax_manager.js"],"names":[],"mappings":";;AAAC,IAAM,OAAQ,QAAQ,iBAAR,CAAR;IACD,SAAS,QAAQ,iBAAR,CAAT;;;AAGN,IAAM,IAAW,QAAQ,aAAR,CAAX;IACA,WAAW,QAAQ,iBAAR,CAAX;IACA,SAAW,QAAQ,eAAR,CAAX;;AAEN,IAAM,cAAc,IAAI,IAAJ,EAAd;;AAEN,IAAI,kBAAkB,EAAlB;;AAEJ,SAAS,MAAT,CAAgB,GAAhB,EAAqB,IAArB,EAA0B;AACxB,MAAG,CAAC,EAAE,MAAF,CAAS,IAAT,CAAD,EAAiB,OAAO,GAAP,CAApB;;AAEA,MAAI,UAAU,OAAO,IAAP,CAAV;;AAHoB,MAKpB,OAAO,QAAQ,QAAR,CAAiB,kBAAjB,CAAP,CALoB;AAMxB,SAAO,IAAI,OAAJ,CAAY,OAAZ,EAAqB,IAArB,CAAP,CANwB;CAA1B;;AAUA,OAAO,OAAP,GAAiB,UAAS,GAAT,EAAa;AAC5B,MAAG,CAAC,GAAD,EAAK;AACN,UAAM,IAAI,KAAJ,CAAU,kBAAV,CAAN,CADM;GAAR;;AAIA,MAAI,iBAAJ;MAAc,aAAd,CAL4B;;AAO5B,SAAO;AACL,iBAAY,qBAAC,CAAD,EAAK;AACf,iBAAW,CAAC,CAAE,UAAF,CAAa,CAAb,CAAD,GAAoB,CAApB,GAAwB,IAAxB,CADI;AAEf,aAAO,QAAP,CAFe;KAAL;;AAKV,cAAS,kBAAC,CAAD,EAAK;AACd,aAAO,CAAC,CAAE,MAAF,CAAS,CAAT,CAAD,GAAgB,CAAhB,GAAoB,IAApB,CADO;AAEd,aAAO,IAAP,CAFc;KAAL;;AAKT,WAAM,iBAAI;AACV,UAAI,MAAM,OAAO,GAAP,EAAY,IAAZ,CAAN,CADM;AAEV,UAAG,SAAS,eAAT,EAA0B,GAA1B,CAAH,EAAmC,OAAO,IAAP,CAAnC;AACA,sBAAgB,IAAhB,CAAqB,GAArB,EAHU;AAIV,kBAAY,MAAZ,CAAmB,OAAO,GAAP,EAAY,IAAZ,CAAnB,EAJU;;AAMV,aAAO,YAAY,KAAZ,CAAkB,QAAlB,EACJ,IADI,CACC,UAAC,IAAD,EAAQ;AACZ,0BAAkB,OAAO,eAAP,EAAwB,UAAC,EAAD;iBAAM,OAAO,GAAP;SAAN,CAA1C;;AADY,eAGL,IAAP,CAHY;OAAR,CADD,CAMJ,KANI,CAME,UAAC,GAAD,EAAO;AACZ,cAAM,IAAI,KAAJ,CAAU,GAAV,CAAN,CADY;OAAP,CANT,CANU;KAAJ;GAXV,CAP4B;CAAb","file":"ajax_manager.js","sourcesContent":[" const Ajax  = require(\"ajax-es6-module\")\n    , Moment = require(\"moment-strftime\");\n    // , DateFormatter = require(\"@djforth/date-formatter\");\n\nconst _        = require(\"lodash/core\")\n    , includes = require(\"lodash/includes\")\n    , reject   = require(\"lodash/reject\")\n\nconst ajaxManager = new Ajax();\n\nlet currentRequests = [];\n\nfunction setApi(api, date){\n  if(!_.isDate(date)) return api;\n\n  let dateFmt = Moment(date);\n  // new DateFormatter(date);\n  let path = dateFmt.strftime(\"/%Y/%m/%d[.json]\");\n  return api.replace(/.json/, path)\n}\n\n\nmodule.exports = function(api){\n  if(!api){\n    throw new Error(\"api url required\");\n  }\n\n  let progress, date;\n\n  return {\n    addProgress:(p)=>{\n      progress = (_.isFunction(p)) ? p : null;\n      return progress;\n    }\n\n    , addQuery:(d)=>{\n      date = (_.isDate(d)) ? d : null;\n      return date;\n    }\n\n    , fetch:()=>{\n      let url = setApi(api, date);\n      if(includes(currentRequests, url)) return null;\n      currentRequests.push(url)\n      ajaxManager.addUrl(setApi(api, date));\n\n      return ajaxManager.fetch(progress)\n        .then((data)=>{\n          currentRequests = reject(currentRequests, (cr)=>cr === url);\n          // console.log(currentRequests)\n          return data;\n        })\n        .catch((err)=>{\n          throw new Error(err);\n        });\n    }\n  }\n}\n"]}