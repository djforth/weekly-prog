{"version":3,"sources":["../../src/utils/ajax_manager.js"],"names":["Ajax","Moment","_","includes","reject","ajaxManager","currentRequests","setApi","api","date","isDate","dateFmt","path","format","replace","Error","progress","addProgress","p","isFunction","addQuery","d","fetch","url","push","addUrl","then","data","cr","catch","err"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,iBAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,CAAP,MAAc,aAAd;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,MAAP,MAAmB,eAAnB;;AAEA,IAAMC,cAAc,IAAIL,IAAJ,EAApB;;AAEA,IAAIM,kBAAkB,EAAtB;;AAEA,SAASC,MAAT,CAAgBC,GAAhB,EAAqBC,IAArB,EAA0B;AACxB,MAAI,CAACP,EAAEQ,MAAF,CAASD,IAAT,CAAL,EAAqB,OAAOD,GAAP;;AAErB,MAAIG,UAAUV,OAAOQ,IAAP,CAAd;AACA,MAAIG,OAAOD,QAAQE,MAAR,CAAe,oBAAf,CAAX;AACA,SAAOL,IAAIM,OAAJ,CAAY,OAAZ,EAAqBF,IAArB,CAAP;AACD;;AAED,eAAe,UAASJ,GAAT,EAAa;AAC1B,MAAI,CAACA,GAAL,EAAS;AACP,UAAM,IAAIO,KAAJ,CAAU,kBAAV,CAAN;AACD;;AAED,MAAIC,iBAAJ;AAAA,MAAcP,aAAd;;AAEA,SAAO;AACLQ,iBAAa,qBAACC,CAAD,EAAK;AAChBF,iBAAYd,EAAEiB,UAAF,CAAaD,CAAb,CAAD,GAAoBA,CAApB,GAAwB,IAAnC;AACA,aAAOF,QAAP;AACD,KAJI;;AAMHI,cAAU,kBAACC,CAAD,EAAK;AACfZ,aAAQP,EAAEQ,MAAF,CAASW,CAAT,CAAD,GAAgBA,CAAhB,GAAoB,IAA3B;AACA,aAAOZ,IAAP;AACD,KATI;;AAWHa,WAAO,iBAAI;AACX,UAAIC,MAAMhB,OAAOC,GAAP,EAAYC,IAAZ,CAAV;AACA,UAAIN,SAASG,eAAT,EAA0BiB,GAA1B,CAAJ,EAAoC,OAAO,IAAP;AACpCjB,sBAAgBkB,IAAhB,CAAqBD,GAArB;AACAlB,kBAAYoB,MAAZ,CAAmBlB,OAAOC,GAAP,EAAYC,IAAZ,CAAnB;;AAEA,aAAOJ,YAAYiB,KAAZ,CAAkBN,QAAlB,EACJU,IADI,CACC,UAACC,IAAD,EAAQ;AACZrB,0BAAkBF,OAAOE,eAAP,EAAwB,UAACsB,EAAD;AAAA,iBAAMA,OAAOL,GAAb;AAAA,SAAxB,CAAlB;AACA;AACA,eAAOI,IAAP;AACD,OALI,EAMJE,KANI,CAME,UAACC,GAAD,EAAO;AACZ,cAAM,IAAIf,KAAJ,CAAUe,GAAV,CAAN;AACD,OARI,CAAP;AASD;AA1BI,GAAP;AA4BD","file":"ajax_manager.js","sourcesContent":["import Ajax from 'ajax-es6-module';\nimport Moment from 'moment';\nimport _ from 'lodash/core';\nimport includes from 'lodash/includes';\nimport reject from 'lodash/reject';\n\nconst ajaxManager = new Ajax();\n\nlet currentRequests = [];\n\nfunction setApi(api, date){\n  if (!_.isDate(date)) return api;\n\n  let dateFmt = Moment(date);\n  let path = dateFmt.format('/YYYY/MM/DD[.json]');\n  return api.replace(/.json/, path);\n}\n\nexport default function(api){\n  if (!api){\n    throw new Error('api url required');\n  }\n\n  let progress, date;\n\n  return {\n    addProgress: (p)=>{\n      progress = (_.isFunction(p)) ? p : null;\n      return progress;\n    }\n\n    , addQuery: (d)=>{\n      date = (_.isDate(d)) ? d : null;\n      return date;\n    }\n\n    , fetch: ()=>{\n      let url = setApi(api, date);\n      if (includes(currentRequests, url)) return null;\n      currentRequests.push(url);\n      ajaxManager.addUrl(setApi(api, date));\n\n      return ajaxManager.fetch(progress)\n        .then((data)=>{\n          currentRequests = reject(currentRequests, (cr)=>cr === url);\n          // console.log(currentRequests)\n          return data;\n        })\n        .catch((err)=>{\n          throw new Error(err);\n        });\n    }\n  };\n};\n"]}