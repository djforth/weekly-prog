{"version":3,"sources":["../../src/utils/ajax_manager.js"],"names":["setApi","api","date","isDate","dateFmt","path","format","replace","Error","progress","addProgress","p","isFunction","addQuery","d","fetch","url","currentRequests","push","console","log","then","data","cr","catch","err"],"mappings":"2pBASA,QAASA,OAAT,CAAgBC,GAAhB,CAAqBC,IAArB,CAA0B,CACxB,GAAI,CAAC,iBAAEC,MAAF,CAASD,IAAT,CAAL,CAAqB,MAAOD,IAAP,CAErB,GAAIG,SAAU,qBAAOF,IAAP,CAAd,CACIG,KAAOD,QAAQE,MAAR,CAAe,oBAAf,CADX,CAEA,MAAOL,KAAIM,OAAJ,CAAY,OAAZ,CAAqBF,IAArB,CACR,C,uEAEc,SAASJ,GAAT,CAAa,CAC1B,GAAI,CAACA,GAAL,CACE,KAAM,IAAIO,MAAJ,CAAU,kBAAV,CAAN,CAGF,GAAIC,SAAJ,CAAcP,IAAd,CAEA,MAAO,CACLQ,YAAa,qBAACC,CAAD,CAAK,CAEhB,MADAF,UAAY,iBAAEG,UAAF,CAAaD,CAAb,CAAD,CAAoBA,CAApB,CAAwB,IACnC,CAAOF,QACR,CAJI,CAMHI,SAAU,kBAACC,CAAD,CAAK,CAEf,MADAZ,MAAQ,iBAAEC,MAAF,CAASW,CAAT,CAAD,CAAgBA,CAAhB,CAAoB,IAC3B,CAAOZ,IACR,CATI,CAWHa,MAAO,UAAI,CACX,GAAIC,KAAMhB,OAAOC,GAAP,CAAYC,IAAZ,CAAV,CACA,GAAI,uBAASe,eAAT,CAA0BD,GAA1B,CAAJ,CAAoC,MAAO,KAAP,CACpCC,gBAAgBC,IAAhB,CAAqBF,GAArB,CAHW,CAIX,GAAMD,OAAQ,oBAAMf,OAAOC,GAAP,CAAYC,IAAZ,CAAN,CAAd,CAGA,MAFAiB,SAAQC,GAAR,CAAY,OAAZ,iBAEA,CADAD,QAAQC,GAAR,CAAY,OAAZ,CAAqBL,KAArB,CACA,CAAOA,QAAQM,IAAR,CAAa,SAACC,IAAD,CAAQ,CAGxB,MAFAL,iBAAkB,qBAAOA,eAAP,CAAwB,SAACM,EAAD,QAAMA,MAAOP,GAAb,CAAxB,CAElB,CAAOM,IACR,CAJI,EAKJE,KALI,CAKE,SAACC,GAAD,CAAO,CACZ,KAAM,IAAIjB,MAAJ,CAAUiB,GAAV,CACP,CAPI,CAQR,CA1BI,CA4BR,C,oNA7CGR,kB","file":"ajax_manager.js","sourcesContent":[" import Fetch from '@djforth/ajax-es6-fp/fetch';\n import Moment from 'moment';\n\n import _ from 'lodash';\n import includes from 'lodash/includes';\n import reject from 'lodash/reject';\n\nlet currentRequests = [];\n\nfunction setApi(api, date){\n  if (!_.isDate(date)) return api;\n\n  let dateFmt = Moment(date);\n  let path = dateFmt.format('/YYYY/MM/DD[.json]');\n  return api.replace(/.json/, path);\n}\n\nexport default function(api){\n  if (!api){\n    throw new Error('api url required');\n  }\n\n  let progress, date;\n\n  return {\n    addProgress: (p)=>{\n      progress = (_.isFunction(p)) ? p : null;\n      return progress;\n    }\n\n    , addQuery: (d)=>{\n      date = (_.isDate(d)) ? d : null;\n      return date;\n    }\n\n    , fetch: ()=>{\n      let url = setApi(api, date);\n      if (includes(currentRequests, url)) return null;\n      currentRequests.push(url);\n      const fetch = Fetch(setApi(api, date));\n      console.log('Fetch', Fetch);\n      console.log('fetch', fetch);\n      return fetch().then((data)=>{\n          currentRequests = reject(currentRequests, (cr)=>cr === url);\n          // console.log(currentRequests)\n          return data;\n        })\n        .catch((err)=>{\n          throw new Error(err);\n        });\n    }\n  };\n};\n"]}