(function(global,factory){if('function'==typeof define&&define.amd)define(['exports','@djforth/ajax-es6-fp/fetch','moment','lodash','lodash/includes','lodash/reject'],factory);else if('undefined'!=typeof exports)factory(exports,require('@djforth/ajax-es6-fp/fetch'),require('moment'),require('lodash'),require('lodash/includes'),require('lodash/reject'));else{var mod={exports:{}};factory(mod.exports,global.fetch,global.moment,global.lodash,global.includes,global.reject),global.ajax_manager=mod.exports}})(this,function(exports,_fetch,_moment,_lodash,_includes,_reject){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function setApi(api,date){if(!_lodash2.default.isDate(date))return api;var dateFmt=(0,_moment2.default)(date),path=dateFmt.format('/YYYY/MM/DD[.json]');return api.replace(/.json/,path)}Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=function(api){if(!api)throw new Error('api url required');var progress,date;return{addProgress:function addProgress(p){return progress=_lodash2.default.isFunction(p)?p:null,progress},addQuery:function addQuery(d){return date=_lodash2.default.isDate(d)?d:null,date},fetch:function(){var url=setApi(api,date);if((0,_includes2.default)(currentRequests,url))return null;currentRequests.push(url);var fetch=(0,_fetch2.default)(setApi(api,date));return console.log('Fetch',_fetch2.default),console.log('fetch',fetch),fetch().then(function(data){return currentRequests=(0,_reject2.default)(currentRequests,function(cr){return cr===url}),data}).catch(function(err){throw new Error(err)})}}};var _fetch2=_interopRequireDefault(_fetch),_moment2=_interopRequireDefault(_moment),_lodash2=_interopRequireDefault(_lodash),_includes2=_interopRequireDefault(_includes),_reject2=_interopRequireDefault(_reject),currentRequests=[]});
//# sourceMappingURL=ajax_manager.js.map