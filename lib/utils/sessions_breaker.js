(function(global,factory){if('function'==typeof define&&define.amd)define(['module','exports','moment-strftime','lodash','./day_checker'],factory);else if('undefined'!=typeof exports)factory(module,exports,require('moment-strftime'),require('lodash'),require('./day_checker'));else{var mod={exports:{}};factory(mod,mod.exports,global.momentStrftime,global.lodash,global.day_checker),global.sessions_breaker=mod.exports}})(this,function(module,exports,_momentStrftime,_lodash,_day_checker){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createKey(date){return date.getFullYear()+'-'+date.getMonth()+'-'+date.getDate()}function groupSessions(sessions){var new_sessions=_lodash2.default.sortBy(sessions,function(s){return s.groupBy}),groups={},ses=_lodash2.default.first(new_sessions);if(_lodash2.default.isUndefined(ses)||_lodash2.default.isEmpty(ses))return groups;var date=_lodash2.default.first(new_sessions).groupBy,key=createKey(date);return groups[key]={date:date,sessions:[]},_lodash2.default.forEach(new_sessions,function(session){return(0,_day_checker2.default)(date,session.groupBy)?groups[key].sessions.push(session):(date=session.groupBy,key=createKey(date),groups[key]={date:date,sessions:[session]}),groups}),groups}function makeDates(sessions,key){return _lodash2.default.map(sessions,function(s){var date=(0,_momentStrftime2.default)(s[key]);return s.groupBy=date.toDate(),s})}function addDay(groups,date){var key=createKey(date.toDate());return groups[key]={date:date.clone().toDate(),sessions:[]},groups}function currentDates(dates){return dates=_lodash2.default.map(dates,function(d){return(0,_momentStrftime2.default)(d)}),function(test){var check=!1;return _lodash2.default.forEach(dates,function(d){if(d.isSame(test,'d'))return check=!0,!1}),check}}function fillGaps(groups,start){var end=2<arguments.length&&arguments[2]!==void 0?arguments[2]:7,dates=currentDates(_lodash2.default.map(_lodash2.default.values(groups),'date'));start=_lodash2.default.isUndefined(start)?_lodash2.default.first(dates):start,start=(0,_momentStrftime2.default)(start),end=start.clone().add(end,'d');do dates(start)||(groups=addDay(groups,start)),start.add(1,'d');while(start.isBefore(end));return groups}Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=function(sessions,groupBy,st){var list=makeDates(sessions,groupBy),groups=groupSessions(list);return fillGaps(groups,st)};var _momentStrftime2=_interopRequireDefault(_momentStrftime),_lodash2=_interopRequireDefault(_lodash),_day_checker2=_interopRequireDefault(_day_checker);module.exports=exports['default']});