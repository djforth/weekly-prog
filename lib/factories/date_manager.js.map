{"version":3,"sources":["../../src/factories/date_manager.js"],"names":["getDate","dates","date","find","d","checkDates","createFactory","groupBy","data","fcty","setTimeKey","createWeek","createFcty","start","Date","week","i","getTime","setDate","push","fetched","dateUpdate","map","add","getNewDate","n","create_date","processForNav","dm","dateFmt","fmt","title","format","alt","today","nosessions","size","resetDates","filter","earliestDate","reduce","prev","curr","ds","fctyCreator","weekCreator","isArray","addDate","isDate","fn","findDate","args","apply","getAll","getAllDates","sort","a","b","getMoreDays","fetch_date","newDates","last","concat","getPreviousDays","updateDate"],"mappings":"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","file":"date_manager.js","sourcesContent":["import checker from '../utils/day_checker';\nimport SessionsFcty from './sessions_fcty';\n// lodash\n\nimport _ from 'lodash';\nimport partial from 'lodash/partial';\nimport Moment from 'moment';\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>checker(d.date, date));\n}\n\n/*eslint-disable*/\nfunction checkDates (dates, date){\n  return (getDate(dates, date)) ? true : false;\n}\n/* eslint-enable*/\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  };\n}\n\nfunction createWeek(createFcty, start = new Date()){\n  // var start = new Date();\n  let week  = [{\n    date: start\n    , data: createFcty([])\n  }];\n  let i = 1;\n\n  do {\n    start = new Date(start.getTime());\n    start.setDate(start.getDate() + 1);\n    week.push({\n      date: start\n      , data: createFcty()\n      , fetched: false\n    });\n\n    i++;\n  } while (i < 7);\n\n  return week;\n}\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if (checker(d.date, date)){\n      // console.log(d.data.size(), data.length)\n      d.data.add(data);\n      // console.log(d.data.size(), data.length)\n      d.fetched = true;\n    }\n    return d;\n  });\n}\n\nfunction getNewDate(date, n = 1){\n  let create_date = new Date(date);\n  create_date.setDate(create_date.getDate() + n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n\n  // if (dm.data.size() === 0) console.log('dm', dm)\n  return {\n    date: dm.date\n    , fmt: dateFmt\n    , title: dateFmt.format('ddd Do')\n    , alt: dateFmt.format('dddd, MMMM Do YYYY')\n    , today: checker(dm.date, new Date())\n    , nosessions: (dm.data.size() === 0 && !dm.fetched)\n  };\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if (prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = partial(createWeek, fctyCreator);\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate: (date, data)=>{\n      if (!_.isDate(date)) return false;\n\n      if (checkDates(dates, date)){\n        let fn = partial(dateUpdate, dates);\n        dates = fn(date, data);\n      } else {\n        let fcty = fctyCreator(data);\n        dates.push({date: date, data: fcty, fetched: true});\n      }\n    }\n\n    , createWeek: weekCreator\n\n    , findDate: (...args)=>{\n      let fn = partial(getDate, dates);\n      return fn.apply(this, args);\n    }\n\n    , getAll: ()=>dates\n\n    , getAllDates: ()=>{\n      // let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if (a.date.getTime() > b.date.getTime()) return 1;\n        if (a.date.getTime() < b.date.getTime()) return -1;\n        return 0;\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched;\n      });\n      if (fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate: (...args)=>{\n      let fn = partial(dateUpdate, dates);\n      dates = fn.apply(this, args);\n    }\n  };\n}\n\nexport default dateManager;\n"]}