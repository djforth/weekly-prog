{"version":3,"sources":["../../src/factories/date_manager.js"],"names":[],"mappings":";;AAAA,IAAM,CAAC,GAAS,OAAO,CAAC,QAAQ,CAAC;IAC3B,OAAO,GAAG,OAAO,CAAC,sBAAsB,CAAC;IACzC,YAAY,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAA;;AAE/C,SAAS,OAAO,CAAC,KAAK,EAAE,IAAI,EAAC;AAC3B,SAAO,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,UAAC,CAAC,EAAG;AACzB,WAAO,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GAC7B,CAAC,CAAC;CACJ;;AAGD,SAAS,UAAU,CAAE,KAAK,EAAE,IAAI,EAAC;;AAE/B,SAAO,AAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,GAAI,IAAI,GAAG,KAAK,CAAC;CAC9C;;AAED,SAAS,aAAa,CAAC,OAAO,EAAC;AAC7B,SAAO,UAAS,IAAI,EAAC;AACnB,QAAI,IAAI,GAAG,IAAI,YAAY,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;AACtC,QAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;;AAEzB,WAAO,IAAI,CAAC;GACb,CAAA;CACF;;AAED,SAAS,eAAe,CAAC,UAAU,EAAC;AAClC,MAAI,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;AACvB,MAAI,IAAI,GAAI,CAAC;AACT,QAAI,EAAC,KAAK;AACV,QAAI,EAAC,UAAU,CAAC,EAAE,CAAC;GACtB,CAAC,CAAC;AACH,MAAI,CAAC,GAAO,CAAC,CAAC;;AAEd,KAAE;AACA,SAAK,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AACvB,SAAK,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,GAAC,CAAC,CAAC,CAAC;AACjC,QAAI,CAAC,IAAI,CAAC;AACN,UAAI,EAAC,KAAK;AACV,UAAI,EAAC,UAAU,EAAE;KACpB,CAAC,CAAC;;AAEH,KAAC,EAAE,CAAC;GACL,QAAO,CAAC,GAAG,CAAC,EAAE;;AAEf,SAAO,IAAI,CAAC;CACb;;AAGD,SAAS,UAAU,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC;AACpC,SAAO,CAAC,CAAC,GAAG,CAAC,KAAK,EAAE,UAAC,CAAC,EAAG;AACvB,QAAG,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,EAAC;AACvB,OAAC,CAAC,IAAI,GAAG,IAAI,CAAC;KACf;AACD,WAAO,CAAC,CAAA;GACT,CAAC,CAAC;CACJ;;AAID,SAAS,WAAW,CAAC,OAAO,EAAE,EAAE,EAAC;;;AAC/B,MAAI,WAAW,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;;AAEzC,MAAI,KAAK,GAAG,AAAC,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,GAAI,EAAE,GAAG,eAAe,CAAC,WAAW,CAAC,CAAC;AAChE,SAAO;AACL,WAAO,EAAC,iBAAC,IAAI,EAAE,IAAI,EAAG;AACpB,UAAG,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,OAAO,KAAK,CAAC;AACjC,UAAI,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;AAC7B,UAAG,UAAU,CAAC,KAAK,EAAC,IAAI,CAAC,EAAC;AACxB,YAAI,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;AACtC,aAAK,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;OACvB,MAAM;AACL,aAAK,CAAC,IAAI,CAAC,EAAC,IAAI,EAAC,IAAI,EAAE,IAAI,EAAC,IAAI,EAAC,CAAC,CAAA;OACnC;KACF;;AAEC,YAAQ,EAAC,oBAAW;wCAAP,IAAI;AAAJ,YAAI;;;AACf,UAAI,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACnC,aAAO,EAAE,CAAC,KAAK,QAAO,IAAI,CAAC,CAAA;KAE5B;;AAED,UAAM,EAAC;aAAI,KAAK;KAAA;;AAEhB,eAAW,EAAC;aAAI,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,CAAC;KAAA;;;;;;AAAA,MAMtC,UAAU,EAAC,sBAAW;yCAAP,IAAI;AAAJ,YAAI;;;AACnB,UAAI,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;AACtC,WAAK,GAAG,EAAE,CAAC,KAAK,QAAO,IAAI,CAAC,CAAA;KAC7B;GACF,CAAA;CACF;;AAED,MAAM,CAAC,OAAO,GAAG,WAAW,CAAC","file":"date_manager.js","sourcesContent":["const _       = require(\"lodash\")\n    , checker = require(\"../utils/day_checker\")\n    , SessionsFcty = require(\"./sessions_fcty\")\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>{\n   return checker(d.date, date);\n  });\n}\n\n\nfunction checkDates (dates, date){\n\n  return (getDate(dates, date)) ? true : false;\n}\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  }\n}\n\nfunction createFirstWeek(createFcty){\n  var start = new Date();\n  var week  = [{\n      date:start\n    , data:createFcty([])\n  }];\n  var i     = 1;\n\n  do{\n    start = _.clone(start);\n    start.setDate(start.getDate()+1);\n    week.push({\n        date:start\n      , data:createFcty()\n    });\n\n    i++;\n  } while(i < 7);\n\n  return week;\n}\n\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if(checker(d.date, date)){\n      d.data = data;\n    }\n    return d\n  });\n}\n\n\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n\n  let dates = (_.isArray(ds)) ? ds : createFirstWeek(fctyCreator);\n  return {\n    addDate:(date, data)=>{\n      if(!_.isDate(date)) return false;\n      let fcty = fctyCreator(data);\n      if(checkDates(dates,date)){\n        let fn = _.partial(dateUpdate, dates);\n        dates = fn(date, fcty)\n      } else {\n        dates.push({date:date, data:fcty})\n      }\n    }\n\n    , findDate:(...args)=>{\n        let fn = _.partial(getDate, dates);\n        return fn.apply(this, args)\n\n      }\n\n    , getAll:()=>dates\n\n    , getAllDates:()=>_.pluck(dates, \"date\")\n\n    // , getRange:(st, fn)=>{\n    //   return _.filter(dates,\n    // }\n\n    , updateDate:(...args)=>{\n      let fn = _.partial(dateUpdate, dates);\n      dates = fn.apply(this, args)\n    }\n  }\n}\n\nmodule.exports = dateManager;"]}