{"version":3,"sources":["../../src/factories/date_manager.js"],"names":[],"mappings":"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","file":"date_manager.js","sourcesContent":["const _       = require(\"lodash\")\n    , checker = require(\"../utils/day_checker\")\n    , SessionsFcty = require(\"./sessions_fcty\")\n    , DateFormatter = require(\"date-formatter\")\n    , Moment = require(\"moment\");\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>{\n   return checker(d.date, date);\n  });\n}\n\n\nfunction checkDates (dates, date){\n\n  return (getDate(dates, date)) ? true : false;\n}\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  }\n}\n\nfunction createWeek(createFcty, start=new Date()){\n  // var start = new Date();\n  var week  = [{\n      date:start\n    , data:createFcty([])\n  }];\n  var i     = 1;\n\n  do{\n    start = _.clone(start);\n    start.setDate(start.getDate()+1);\n    week.push({\n        date:start\n      , data:createFcty()\n      , fetched:false\n    });\n\n    i++;\n  } while(i < 7);\n\n  return week;\n}\n\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if(checker(d.date, date)){\n      d.data = data;\n      d.fetched = true;\n    }\n    return d\n  });\n}\n\nfunction getNewDate(date, n=1){\n  let create_date = _.clone(date);\n  create_date.setDate(create_date.getDate()+n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n  return {\n      date:dm.date\n    , fmt:dateFmt\n    , title:dateFmt.format(\"ddd Do\")\n    , alt:dateFmt.format(\"dddd, MMMM Do YYYY\")\n    , today: checker(dm.date, new Date())\n    , nosessions:(dm.data.size() === 0 && !dm.fetched)\n  }\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if(prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\n\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = _.partial(createWeek, fctyCreator)\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate:(date, data)=>{\n      if(!_.isDate(date)) return false;\n      let fcty = fctyCreator(data);\n      if(checkDates(dates,date)){\n        let fn = _.partial(dateUpdate, dates);\n        dates = fn(date, fcty)\n      } else {\n        dates.push({date:date, data:fcty, fetched:true})\n      }\n    }\n\n    , createWeek:weekCreator\n\n    , findDate:(...args)=>{\n        let fn = _.partial(getDate, dates);\n        return fn.apply(this, args)\n\n      }\n\n    , getAll:()=>dates\n\n    , getAllDates:()=>{\n      let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if(a.date.getTime() > b.date.getTime()) return 1;\n        if(a.date.getTime() < b.date.getTime()) return -1;\n        return 0\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched\n      });\n      if(fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate:(...args)=>{\n      let fn = _.partial(dateUpdate, dates);\n      dates = fn.apply(this, args)\n    }\n  }\n}\n\nmodule.exports = dateManager;"]}