{"version":3,"sources":["../../src/factories/date_manager.js"],"names":["checker","SessionsFcty","_","partial","Moment","getDate","dates","date","find","d","checkDates","createFactory","groupBy","data","fcty","setTimeKey","createWeek","createFcty","start","Date","week","i","getTime","setDate","push","fetched","dateUpdate","map","add","getNewDate","n","create_date","processForNav","dm","dateFmt","fmt","title","format","alt","today","nosessions","size","resetDates","filter","earliestDate","reduce","prev","curr","dateManager","ds","fctyCreator","weekCreator","isArray","addDate","isDate","fn","findDate","args","apply","getAll","getAllDates","sort","a","b","getMoreDays","fetch_date","newDates","last","concat","getPreviousDays","updateDate"],"mappings":"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","file":"date_manager.js","sourcesContent":["import checker from '../utils/day_checker';\nimport SessionsFcty from './sessions_fcty';\n// lodash\n\nimport _ from 'lodash/core';\n\nimport partial from 'lodash/partial';\n\nimport Moment from 'moment';\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>checker(d.date, date));\n}\n\n/*eslint-disable*/\nfunction checkDates (dates, date){\n  return (getDate(dates, date)) ? true : false;\n}\n/*eslint-enable*/\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  };\n}\n\nfunction createWeek(createFcty, start = new Date()){\n  // var start = new Date();\n  var week  = [{\n    date: start\n    , data: createFcty([])\n  }];\n  var i = 1;\n\n  do {\n    start = new Date(start.getTime());\n    start.setDate(start.getDate() + 1);\n    week.push({\n      date: start\n      , data: createFcty()\n      , fetched: false\n    });\n\n    i++;\n  } while (i < 7);\n\n  return week;\n}\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if (checker(d.date, date)){\n      // console.log(d.data.size(), data.length)\n      d.data.add(data);\n      // console.log(d.data.size(), data.length)\n      d.fetched = true;\n    }\n    return d;\n  });\n}\n\nfunction getNewDate(date, n = 1){\n  let create_date = new Date(date);\n  create_date.setDate(create_date.getDate() + n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n\n  // if (dm.data.size() === 0) console.log('dm', dm)\n  return {\n    date: dm.date\n    , fmt: dateFmt\n    , title: dateFmt.format('ddd Do')\n    , alt: dateFmt.format('dddd, MMMM Do YYYY')\n    , today: checker(dm.date, new Date())\n    , nosessions: (dm.data.size() === 0 && !dm.fetched)\n  };\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if (prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = partial(createWeek, fctyCreator);\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate: (date, data)=>{\n      if (!_.isDate(date)) return false;\n\n      if (checkDates(dates,date)){\n        let fn = partial(dateUpdate, dates);\n        dates = fn(date, data);\n      } else {\n        let fcty = fctyCreator(data);\n        dates.push({date: date, data: fcty, fetched: true});\n      }\n    }\n\n    , createWeek: weekCreator\n\n    , findDate: (...args)=>{\n      let fn = partial(getDate, dates);\n      return fn.apply(this, args);\n    }\n\n    , getAll: ()=>dates\n\n    , getAllDates: ()=>{\n      // let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if (a.date.getTime() > b.date.getTime()) return 1;\n        if (a.date.getTime() < b.date.getTime()) return -1;\n        return 0;\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched;\n      });\n      if (fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate: (...args)=>{\n      let fn = partial(dateUpdate, dates);\n      dates = fn.apply(this, args);\n    }\n  };\n}\n\nexport default dateManager;\n"]}