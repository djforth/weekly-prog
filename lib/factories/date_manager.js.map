{"version":3,"sources":["../../src/factories/date_manager.js"],"names":[],"mappings":"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","file":"date_manager.js","sourcesContent":["const checker = require('../utils/day_checker')\n    , SessionsFcty = require('./sessions_fcty');\n\n// lodash\nconst _ = require('lodash/core')\n     , partial = require('lodash/partial');\nconst Moment = require('moment');\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>checker(d.date, date));\n}\n\n/*eslint-disable*/\nfunction checkDates (dates, date){\n  return (getDate(dates, date)) ? true : false;\n}\n/*eslint-enable*/\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  };\n}\n\nfunction createWeek(createFcty, start = new Date()){\n  // var start = new Date();\n  var week  = [{\n    date: start\n    , data: createFcty([])\n  }];\n  var i = 1;\n\n  do {\n    start = new Date(start.getTime());\n    start.setDate(start.getDate() + 1);\n    week.push({\n      date: start\n      , data: createFcty()\n      , fetched: false\n    });\n\n    i++;\n  } while (i < 7);\n\n  return week;\n}\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if (checker(d.date, date)){\n      // console.log(d.data.size(), data.length)\n      d.data.add(data);\n      // console.log(d.data.size(), data.length)\n      d.fetched = true;\n    }\n    return d;\n  });\n}\n\nfunction getNewDate(date, n = 1){\n  let create_date = new Date(date);\n  create_date.setDate(create_date.getDate() + n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n\n  // if (dm.data.size() === 0) console.log('dm', dm)\n  return {\n    date: dm.date\n    , fmt: dateFmt\n    , title: dateFmt.format('ddd Do')\n    , alt: dateFmt.format('dddd, MMMM Do YYYY')\n    , today: checker(dm.date, new Date())\n    , nosessions: (dm.data.size() === 0 && !dm.fetched)\n  };\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if (prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = partial(createWeek, fctyCreator);\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate: (date, data)=>{\n      if (!_.isDate(date)) return false;\n\n      if (checkDates(dates,date)){\n        let fn = partial(dateUpdate, dates);\n        dates = fn(date, data);\n      } else {\n        let fcty = fctyCreator(data);\n        dates.push({date: date, data: fcty, fetched: true});\n      }\n    }\n\n    , createWeek: weekCreator\n\n    , findDate: (...args)=>{\n      let fn = partial(getDate, dates);\n      return fn.apply(this, args);\n    }\n\n    , getAll: ()=>dates\n\n    , getAllDates: ()=>{\n      // let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if (a.date.getTime() > b.date.getTime()) return 1;\n        if (a.date.getTime() < b.date.getTime()) return -1;\n        return 0;\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched;\n      });\n      if (fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate: (...args)=>{\n      let fn = partial(dateUpdate, dates);\n      dates = fn.apply(this, args);\n    }\n  };\n}\n\nmodule.exports = dateManager;\n"]}