{"version":3,"sources":["../../src/factories/date_manager.js"],"names":[],"mappings":"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","file":"date_manager.js","sourcesContent":["const checker = require('../utils/day_checker')\n    , SessionsFcty = require('./sessions_fcty');\n\n// lodash\nconst _ = require('lodash/core')\n     , partial = require('lodash/partial');\nconst Moment = require('moment');\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>checker(d.date, date));\n}\n\n/*eslint-disable*/\nfunction checkDates (dates, date){\n  return (getDate(dates, date)) ? true : false;\n}\n/*eslint-enable*/\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  };\n}\n\nfunction createWeek(createFcty, start = new Date()){\n  // var start = new Date();\n  var week  = [{\n    date: start\n    , data: createFcty([])\n  }];\n  var i = 1;\n\n  do {\n    start = new Date(start.getTime());\n    start.setDate(start.getDate() + 1);\n    week.push({\n      date: start\n      , data: createFcty()\n      , fetched: false\n    });\n\n    i++;\n  } while (i < 7);\n\n  return week;\n}\n\nfunction dateUpdate(dates, date, data){\n  return _.map(dates, (d)=>{\n    if (checker(d.date, date)){\n      // console.log(d.data.size(), data.length)\n      d.data.add(data);\n      // console.log(d.data.size(), data.length)\n      d.fetched = true;\n    }\n    return d;\n  });\n}\n\nfunction getNewDate(date, n = 1){\n  let create_date = new Date(date);\n  create_date.setDate(create_date.getDate() + n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n\n  // if (dm.data.size() === 0) console.log('dm', dm)\n  return {\n    date: dm.date\n    , fmt: dateFmt\n    , title: dateFmt.format('ddd Do')\n    , alt: dateFmt.format('dddd, MMMM Do YYYY')\n    , today: checker(dm.date, new Date())\n    , nosessions: (dm.data.size() === 0 && !dm.fetched)\n  };\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if (prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = partial(createWeek, fctyCreator);\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate: (date, data)=>{\n      if (!_.isDate(date)) return false;\n\n      if (checkDates(dates,date)){\n        let fn = partial(dateUpdate, dates);\n        dates = fn(date, data);\n      } else {\n        let fcty = fctyCreator(data);\n        dates.push({date: date, data: fcty, fetched: true});\n      }\n    }\n\n    , createWeek: weekCreator\n\n    , findDate: (...args)=>{\n      let fn = partial(getDate, dates);\n      return fn.apply(this, args);\n    }\n\n    , getAll: ()=>dates\n\n    , getAllDates: ()=>{\n      // let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if (a.date.getTime() > b.date.getTime()) return 1;\n        if (a.date.getTime() < b.date.getTime()) return -1;\n        return 0;\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched;\n      });\n      if (fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate: (...args)=>{\n      let fn = partial(dateUpdate, dates);\n      dates = fn.apply(this, args);\n    }\n  };\n}\n\nmodule.exports = dateManager;\n"]}