{"version":3,"sources":["../../src/factories/date_manager.js"],"names":[],"mappings":";;AAAA,IAAM,IAAU,QAAQ,QAAR,CAAV;IACA,UAAU,QAAQ,sBAAR,CAAV;IACA,eAAe,QAAQ,iBAAR,CAAf;IACA,gBAAgB,QAAQ,yBAAR,CAAhB;IACA,SAAS,QAAQ,QAAR,CAAT;;AAEN,SAAS,OAAT,CAAiB,KAAjB,EAAwB,IAAxB,EAA6B;AAC3B,SAAO,EAAE,IAAF,CAAO,KAAP,EAAc,UAAC,CAAD,EAAK;AACzB,WAAO,QAAQ,EAAE,IAAF,EAAQ,IAAhB,CAAP,CADyB;GAAL,CAArB,CAD2B;CAA7B;;AAOA,SAAS,UAAT,CAAqB,KAArB,EAA4B,IAA5B,EAAiC;;AAE/B,SAAO,OAAC,CAAQ,KAAR,EAAe,IAAf,CAAD,GAAyB,IAAzB,GAAgC,KAAhC,CAFwB;CAAjC;;AAKA,SAAS,aAAT,CAAuB,OAAvB,EAA+B;AAC7B,SAAO,UAAS,IAAT,EAAc;AACnB,QAAI,OAAO,IAAI,YAAJ,CAAiB,EAAjB,EAAqB,IAArB,CAAP,CADe;AAEnB,SAAK,UAAL,CAAgB,OAAhB,EAFmB;;AAInB,WAAO,IAAP,CAJmB;GAAd,CADsB;CAA/B;;AASA,SAAS,UAAT,CAAoB,UAApB,EAAiD;MAAjB,8DAAM,IAAI,IAAJ,kBAAW;;;AAE/C,MAAI,OAAQ,CAAC;AACT,UAAK,KAAL;AACA,UAAK,WAAW,EAAX,CAAL;GAFQ,CAAR,CAF2C;AAM/C,MAAI,IAAQ,CAAR,CAN2C;;AAQ/C,KAAE;AACA,YAAQ,EAAE,KAAF,CAAQ,KAAR,CAAR,CADA;AAEA,UAAM,OAAN,CAAc,MAAM,OAAN,KAAgB,CAAhB,CAAd,CAFA;AAGA,SAAK,IAAL,CAAU;AACN,YAAK,KAAL;AACA,YAAK,YAAL;AACA,eAAQ,KAAR;KAHJ,EAHA;;AASA,QATA;GAAF,QAUQ,IAAI,CAAJ,EAlBuC;;AAoB/C,SAAO,IAAP,CApB+C;CAAjD;;AAwBA,SAAS,UAAT,CAAoB,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,EAAsC;;AAEpC,SAAO,EAAE,GAAF,CAAM,KAAN,EAAa,UAAC,CAAD,EAAK;AACvB,QAAG,QAAQ,EAAE,IAAF,EAAQ,IAAhB,CAAH,EAAyB;;AAEvB,QAAE,IAAF,CAAO,GAAP,CAAW,IAAX;;AAFuB,OAIvB,CAAE,OAAF,GAAY,IAAZ,CAJuB;KAAzB;AAMA,WAAO,CAAP,CAPuB;GAAL,CAApB,CAFoC;CAAtC;;AAaA,SAAS,UAAT,CAAoB,IAApB,EAA8B;MAAJ,0DAAE,iBAAE;;AAC5B,MAAI,cAAc,EAAE,KAAF,CAAQ,IAAR,CAAd,CADwB;AAE5B,cAAY,OAAZ,CAAoB,YAAY,OAAZ,KAAsB,CAAtB,CAApB,CAF4B;AAG5B,SAAO,WAAP,CAH4B;CAA9B;;AAMA,SAAS,aAAT,CAAuB,EAAvB,EAA0B;AACxB,MAAI,UAAU,OAAO,GAAG,IAAH,CAAjB;;;AADoB,SAIjB;AACH,UAAK,GAAG,IAAH;AACL,SAAI,OAAJ;AACA,WAAM,QAAQ,MAAR,CAAe,QAAf,CAAN;AACA,SAAI,QAAQ,MAAR,CAAe,oBAAf,CAAJ;AACA,WAAO,QAAQ,GAAG,IAAH,EAAS,IAAI,IAAJ,EAAjB,CAAP;AACA,gBAAY,GAAG,IAAH,CAAQ,IAAR,OAAmB,CAAnB,IAAwB,CAAC,GAAG,OAAH;GANzC,CAJwB;CAA1B;;AAcA,SAAS,WAAT,CAAoB,KAApB,EAA0B;AACxB,SAAO,EAAE,MAAF,CAAS,KAAT,EAAgB,UAAC,EAAD;WAAM,QAAQ,GAAG,IAAH,EAAS,IAAI,IAAJ,EAAjB;GAAN,CAAvB,CADwB;CAA1B;;AAIA,SAAS,YAAT,CAAsB,KAAtB,EAA4B;AAC1B,SAAO,EAAE,MAAF,CAAS,KAAT,EAAgB,UAAC,IAAD,EAAO,IAAP,EAAc;AACnC,QAAG,KAAK,IAAL,CAAU,OAAV,KAAsB,KAAK,IAAL,CAAU,OAAV,EAAtB,EAA0C;AAC3C,aAAO,IAAP,CAD2C;KAA7C;;AAIA,WAAO,IAAP,CALmC;GAAd,CAAvB,CAD0B;CAA5B;;AAYA,SAAS,WAAT,CAAqB,OAArB,EAA8B,EAA9B,EAAiC;;;AAC/B,MAAI,cAAc,cAAc,OAAd,CAAd,CAD2B;AAE/B,MAAI,cAAc,EAAE,OAAF,CAAU,UAAV,EAAsB,WAAtB,CAAd,CAF2B;AAG/B,MAAI,QAAQ,CAAC,CAAE,OAAF,CAAU,EAAV,CAAD,GAAkB,EAAlB,GAAuB,aAAvB,CAHmB;;AAK/B,SAAO;AACL,aAAQ,iBAAC,IAAD,EAAO,IAAP,EAAc;AACpB,UAAG,CAAC,EAAE,MAAF,CAAS,IAAT,CAAD,EAAiB,OAAO,KAAP,CAApB;;AAEA,UAAG,WAAW,KAAX,EAAiB,IAAjB,CAAH,EAA0B;AACxB,YAAI,KAAK,EAAE,OAAF,CAAU,UAAV,EAAsB,KAAtB,CAAL,CADoB;AAExB,gBAAQ,GAAG,IAAH,EAAS,IAAT,CAAR,CAFwB;OAA1B,MAGO;AACL,YAAI,OAAO,YAAY,IAAZ,CAAP,CADC;AAEL,cAAM,IAAN,CAAW,EAAC,MAAK,IAAL,EAAW,MAAK,IAAL,EAAW,SAAQ,IAAR,EAAlC,EAFK;OAHP;KAHM;;AAYN,gBAAW,WAAX;;AAEA,cAAS,oBAAW;wCAAP;;OAAO;;AAClB,UAAI,KAAK,EAAE,OAAF,CAAU,OAAV,EAAmB,KAAnB,CAAL,CADc;AAElB,aAAO,GAAG,KAAH,QAAe,IAAf,CAAP,CAFkB;KAAX;;AAMT,YAAO;aAAI;KAAJ;;AAEP,iBAAY,uBAAI;AAChB,UAAI,QAAQ,IAAI,IAAJ,EAAR,CADY;;AAGhB,cAAQ,MAAM,IAAN,CAAW,UAAC,CAAD,EAAI,CAAJ,EAAQ;AACzB,YAAG,EAAE,IAAF,CAAO,OAAP,KAAmB,EAAE,IAAF,CAAO,OAAP,EAAnB,EAAqC,OAAO,CAAP,CAAxC;AACA,YAAG,EAAE,IAAF,CAAO,OAAP,KAAmB,EAAE,IAAF,CAAO,OAAP,EAAnB,EAAqC,OAAO,CAAC,CAAD,CAA/C;AACA,eAAO,CAAP,CAHyB;OAAR,CAAnB,CAHgB;AAQhB,aAAO,EAAE,GAAF,CAAM,KAAN,EAAa,UAAC,EAAD;eAAM,cAAc,EAAd;OAAN,CAApB,CARgB;KAAJ;;AAvBT,MAkCH,oCAAa;AACb,UAAI,aAAa,EAAE,IAAF,CAAO,KAAP,EAAc,UAAC,EAAD,EAAM;AACnC,eAAO,GAAG,IAAH,CAAQ,IAAR,OAAmB,CAAnB,IAAwB,CAAC,GAAG,OAAH,CADG;OAAN,CAA3B,CADS;AAIb,UAAG,UAAH,EAAe,OAAO,WAAW,IAAX,CAAtB;;AAEA,UAAI,WAAW,YAAY,WAAW,EAAE,IAAF,CAAO,KAAP,EAAc,IAAd,CAAvB,CAAX,CANS;AAOb,cAAQ,MAAM,MAAN,CAAa,QAAb,CAAR,CAPa;;AASb,aAAO,aAAa,QAAb,EAAuB,IAAvB,CATM;KAlCV;AA8CH,8CAAgB,MAAK;AACrB,UAAI,WAAW,YAAY,WAAW,IAAX,EAAiB,CAAC,CAAD,CAA7B,CAAX,CADiB;AAErB,cAAQ,MAAM,MAAN,CAAa,QAAb,CAAR,CAFqB;AAGrB,aAAO,aAAa,QAAb,EAAuB,IAAvB,CAHc;KA9ClB;AAoDH,sCAAY;AACZ,cAAQ,YAAW,KAAX,CAAR,CADY;KApDT;AAwDH,gBAAW,sBAAW;yCAAP;;OAAO;;AACtB,UAAI,KAAK,EAAE,OAAF,CAAU,UAAV,EAAsB,KAAtB,CAAL,CADkB;AAEtB,cAAQ,GAAG,KAAH,QAAe,IAAf,CAAR,CAFsB;KAAX;GAxDf,CAL+B;CAAjC;;AAoEA,OAAO,OAAP,GAAiB,WAAjB","file":"date_manager.js","sourcesContent":["const _       = require(\"lodash\")\n    , checker = require(\"../utils/day_checker\")\n    , SessionsFcty = require(\"./sessions_fcty\")\n    , DateFormatter = require(\"@djforth/date-formatter\")\n    , Moment = require(\"moment\");\n\nfunction getDate(dates, date){\n  return _.find(dates, (d)=>{\n   return checker(d.date, date);\n  });\n}\n\n\nfunction checkDates (dates, date){\n\n  return (getDate(dates, date)) ? true : false;\n}\n\nfunction createFactory(groupBy){\n  return function(data){\n    let fcty = new SessionsFcty({}, data);\n    fcty.setTimeKey(groupBy);\n\n    return fcty;\n  }\n}\n\nfunction createWeek(createFcty, start=new Date()){\n  // var start = new Date();\n  var week  = [{\n      date:start\n    , data:createFcty([])\n  }];\n  var i     = 1;\n\n  do{\n    start = _.clone(start);\n    start.setDate(start.getDate()+1);\n    week.push({\n        date:start\n      , data:createFcty()\n      , fetched:false\n    });\n\n    i++;\n  } while(i < 7);\n\n  return week;\n}\n\n\nfunction dateUpdate(dates, date, data){\n\n  return _.map(dates, (d)=>{\n    if(checker(d.date, date)){\n      // console.log(d.data.size(), data.length)\n      d.data.add(data);\n      // console.log(d.data.size(), data.length)\n      d.fetched = true;\n    }\n    return d\n  });\n}\n\nfunction getNewDate(date, n=1){\n  let create_date = _.clone(date);\n  create_date.setDate(create_date.getDate()+n);\n  return create_date;\n}\n\nfunction processForNav(dm){\n  let dateFmt = Moment(dm.date);\n\n  // if(dm.data.size() === 0) console.log(\"dm\", dm)\n  return {\n      date:dm.date\n    , fmt:dateFmt\n    , title:dateFmt.format(\"ddd Do\")\n    , alt:dateFmt.format(\"dddd, MMMM Do YYYY\")\n    , today: checker(dm.date, new Date())\n    , nosessions:(dm.data.size() === 0 && !dm.fetched)\n  }\n}\n\nfunction resetDates(dates){\n  return _.filter(dates, (dm)=>checker(dm.date, new Date()));\n}\n\nfunction earliestDate(dates){\n  return _.reduce(dates, (prev, curr)=>{\n    if(prev.date.getTime() > curr.date.getTime()){\n      return curr;\n    }\n\n    return prev;\n  });\n}\n\n\n\nfunction dateManager(groupBy, ds){\n  let fctyCreator = createFactory(groupBy);\n  let weekCreator = _.partial(createWeek, fctyCreator)\n  let dates = (_.isArray(ds)) ? ds : weekCreator();\n\n  return {\n    addDate:(date, data)=>{\n      if(!_.isDate(date)) return false;\n\n      if(checkDates(dates,date)){\n        let fn = _.partial(dateUpdate, dates);\n        dates = fn(date, data)\n      } else {\n        let fcty = fctyCreator(data);\n        dates.push({date:date, data:fcty, fetched:true})\n      }\n    }\n\n    , createWeek:weekCreator\n\n    , findDate:(...args)=>{\n        let fn = _.partial(getDate, dates);\n        return fn.apply(this, args)\n\n      }\n\n    , getAll:()=>dates\n\n    , getAllDates:()=>{\n      let today = new Date();\n\n      dates = dates.sort((a, b)=>{\n        if(a.date.getTime() > b.date.getTime()) return 1;\n        if(a.date.getTime() < b.date.getTime()) return -1;\n        return 0\n      });\n      return _.map(dates, (dm)=>processForNav(dm));\n    }\n    // Should refactor this ADE\n    , getMoreDays(){\n      let fetch_date = _.find(dates, (dm)=>{\n        return dm.data.size() === 0 && !dm.fetched\n      });\n      if(fetch_date) return fetch_date.date;\n\n      let newDates = weekCreator(getNewDate(_.last(dates).date));\n      dates = dates.concat(newDates);\n\n      return earliestDate(newDates).date;\n    }\n\n    , getPreviousDays(date){\n      let newDates = weekCreator(getNewDate(date, -7));\n      dates = dates.concat(newDates);\n      return earliestDate(newDates).date;\n    }\n\n    , resetDates(){\n      dates = resetDates(dates);\n    }\n\n    , updateDate:(...args)=>{\n      let fn = _.partial(dateUpdate, dates);\n      dates = fn.apply(this, args)\n    }\n  }\n}\n\nmodule.exports = dateManager;"]}