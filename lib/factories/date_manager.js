(function(global,factory){if('function'==typeof define&&define.amd)define(['exports','../utils/day_checker','./sessions_fcty','lodash','lodash/partial','moment'],factory);else if('undefined'!=typeof exports)factory(exports,require('../utils/day_checker'),require('./sessions_fcty'),require('lodash'),require('lodash/partial'),require('moment'));else{var mod={exports:{}};factory(mod.exports,global.day_checker,global.sessions_fcty,global.lodash,global.partial,global.moment),global.date_manager=mod.exports}})(this,function(exports,_day_checker,_sessions_fcty,_lodash,_partial,_moment){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getDate(dates,date){return _lodash2.default.find(dates,function(d){return(0,_day_checker2.default)(d.date,date)})}function checkDates(dates,date){return!!getDate(dates,date)}function createFactory(groupBy){return function(data){var fcty=new _sessions_fcty2.default({},data);return fcty.setTimeKey(groupBy),fcty}}function createWeek(createFcty){var start=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Date,week=[{date:start,data:createFcty([])}],i=1;do start=new Date(start.getTime()),start.setDate(start.getDate()+1),week.push({date:start,data:createFcty(),fetched:!1}),i++;while(7>i);return week}function dateUpdate(dates,date,data){return _lodash2.default.map(dates,function(d){return(0,_day_checker2.default)(d.date,date)&&(d.data.add(data),d.fetched=!0),d})}function getNewDate(date){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,create_date=new Date(date);return create_date.setDate(create_date.getDate()+n),create_date}function processForNav(dm){var dateFmt=(0,_moment2.default)(dm.date);return{date:dm.date,fmt:dateFmt,title:dateFmt.format('ddd Do'),alt:dateFmt.format('dddd, MMMM Do YYYY'),today:(0,_day_checker2.default)(dm.date,new Date),nosessions:0===dm.data.size()&&!dm.fetched}}function _resetDates(dates){return _lodash2.default.filter(dates,function(dm){return(0,_day_checker2.default)(dm.date,new Date)})}function earliestDate(dates){return _lodash2.default.reduce(dates,function(prev,curr){return prev.date.getTime()>curr.date.getTime()?curr:prev})}Object.defineProperty(exports,'__esModule',{value:!0});var _day_checker2=_interopRequireDefault(_day_checker),_sessions_fcty2=_interopRequireDefault(_sessions_fcty),_lodash2=_interopRequireDefault(_lodash),_partial2=_interopRequireDefault(_partial),_moment2=_interopRequireDefault(_moment);exports.default=function(groupBy,ds){var _this=this,fctyCreator=createFactory(groupBy),weekCreator=(0,_partial2.default)(createWeek,fctyCreator),dates=_lodash2.default.isArray(ds)?ds:weekCreator();return{addDate:function(date,data){if(!_lodash2.default.isDate(date))return!1;if(checkDates(dates,date)){var fn=(0,_partial2.default)(dateUpdate,dates);dates=fn(date,data)}else{var fcty=fctyCreator(data);dates.push({date:date,data:fcty,fetched:!0})}},createWeek:weekCreator,findDate:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var fn=(0,_partial2.default)(getDate,dates);return fn.apply(_this,args)},getAll:function(){return dates},getAllDates:function(){return dates=dates.sort(function(a,b){return a.date.getTime()>b.date.getTime()?1:a.date.getTime()<b.date.getTime()?-1:0}),_lodash2.default.map(dates,function(dm){return processForNav(dm)})},getMoreDays:function(){var fetch_date=_lodash2.default.find(dates,function(dm){return 0===dm.data.size()&&!dm.fetched});if(fetch_date)return fetch_date.date;var newDates=weekCreator(getNewDate(_lodash2.default.last(dates).date));return dates=dates.concat(newDates),earliestDate(newDates).date},getPreviousDays:function(date){var newDates=weekCreator(getNewDate(date,-7));return dates=dates.concat(newDates),earliestDate(newDates).date},resetDates:function(){dates=_resetDates(dates)},updateDate:function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var fn=(0,_partial2.default)(dateUpdate,dates);dates=fn.apply(_this,args)}}}});
//# sourceMappingURL=date_manager.js.map