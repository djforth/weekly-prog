{"version":3,"sources":["../../src/stores/columns_store.js"],"names":[],"mappings":"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","file":"columns_store.js","sourcesContent":["const EventEmitter  = require(\"events\").EventEmitter;\nconst assign        = require(\"react/lib/Object.assign\");\n\nconst _    = require(\"lodash/core\")\n    , includes = require(\"lodash/includes\")\n    , pick = require(\"lodash/pick\");\n\nconst textMixins = require(\"morse-react-mixins\").text_mixins;\nconst ColumnsDispatcher = require(\"../dispatchers/columns_dispatcher\");\n\n\n\n\nconst store = {\n  device          : \"desktop\",\n  columns         : [],\n  columns_ids     : [],\n  visible_columns : [],\n\n\n  emitChange(event) {\n    this.emit(event);\n  },\n\n  addChangeListener(event, callback) {\n    this.on(event, callback);\n  },\n\n  removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  },\n\n  addColumns(c, id){\n    id   = id || _.uniqueId();\n    let cols = this.setTitles(c);\n    this.columns.push({id:id, cols:cols, visible:this.setVisibleColumns(cols)});\n    // console.log('columns', this.columns);\n    return id;\n  },\n\n  changeDevice(d){\n    this.device = (d) ? d : this.device;\n    this.columns = _.map(this.columns, (col)=>{\n      col.visible = this.setVisibleColumns(col.cols);\n      return col;\n    });\n\n  },\n\n  getDevice(){\n    return this.device;\n  },\n\n  getColumn(id){\n    let items;\n    if(id){\n      items =  _.find(this.columns, (col)=>{\n        return col.id === id;\n      });\n    } else {\n      items = _.first(this.columns);\n    }\n\n    if(items){\n      return items;\n    }\n\n    return {cols:[], visible:[]};\n  },\n\n  getDateColumns(id){\n    let column = this.getColumn(id).cols;\n    let dates = _.chain(column)\n      .filter((col)=>(col.type === \"date\" || col.type === \"dateTime\"))\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\", \"type\", \"fmt\"]))\n      .value();\n\n    return dates;\n  },\n\n  getHeadline(id){\n    return _.find(this.getColumn(id).visible, (col)=>{\n      return col.headline;\n    });\n  },\n\n  getKeys(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, \"key\");\n  },\n\n  getKeyAndTitle(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, (col)=> this.reduceObj(col, [\"key\", \"title\"]));\n  },\n\n  getLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return col.label;\n    });\n  },\n\n  getNonLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return _.isBoolean(col.label) && !col.label;\n    });\n  },\n\n  getSearchable(id){\n    let column = this.getColumn(id).cols;\n    let searchables = _.chain(column)\n      .filter((col)=>col.searchable)\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n\n    return searchables;\n  },\n\n  getShowable(id){\n    let column = this.getColumn(id);\n    let showables = _.chain(column.cols)\n      .filter((col)=>{\n        return col.show && !includes(column.visible, col);\n      })\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n    return showables;\n  },\n\n  getSortable(id){\n    let column = this.getColumn(id).cols;\n    let sortables = _.chain(column)\n      .filter((col)=>col.sortable)\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n\n    return sortables;\n  },\n\n  getTitles(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, \"title\");\n  },\n\n  getTitleForKey(key, id){\n    let column = this.getColumn(id).cols;\n    let item = _.find(column, (col)=> col.key === key );\n    return item.title;\n  },\n\n  getVisible(id){\n    return this.getColumn(id).visible;\n  },\n\n  reduceObj(obj, values){\n    return pick(obj, values)\n  },\n\n  removeCols(removeItems){\n    return _.reject(this.columns, (col)=>{\n      return includes(removeItems, col);\n    });\n  },\n\n  setVisibleColumns(cols){\n    let check = {};\n    check[this.device] = true;\n\n    return _.filter(cols, (c)=>c[this.device]);\n  },\n\n  setTitles(columns){\n    columns = _.map(columns, function(col){\n      // console.log(that.capitalize)\n      if(!_.has(col, \"title\")){\n        let title = this.capitalize(col.key);\n        col.title = title;\n      }\n\n      return col;\n    }.bind(this));\n\n    return columns;\n  }\n};\n\nObject.assign(store, textMixins);\n\n\nconst ColumnsStore = assign({}, EventEmitter.prototype, store);\n\nconst registeredCallback = function(payload) {\n  let action = payload.action;\n  switch(action.type) {\n    case \"ADDING_COLUMNS\":\n      ColumnsStore.addColumns(action.columns, action.id);\n      ColumnsStore.emitChange(\"adding\");\n      break;\n\n    case \"CHANGE_DEVICE\":\n      ColumnsStore.changeDevice(action.device);\n      ColumnsStore.emitChange(\"change\");\n      break;\n    }\n};\n\nColumnsStore.dispatchToken = ColumnsDispatcher.register(registeredCallback);\nColumnsStore.setMaxListeners(0);\n\nmodule.exports = ColumnsStore;\n"]}