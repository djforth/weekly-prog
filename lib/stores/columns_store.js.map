{"version":3,"sources":["../../src/stores/columns_store.js"],"names":[],"mappings":"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","file":"columns_store.js","sourcesContent":["const EventEmitter  = require(\"events\").EventEmitter;\nconst assign        = require(\"react/lib/Object.assign\");\n\nconst _ = require(\"lodash\");\n\nconst textMixins = require(\"morse-react-mixins\").text_mixins;\nconst ColumnsDispatcher = require(\"../dispatchers/columns_dispatcher\");\n\n\n\n\nconst store = {\n  device          : \"desktop\",\n  columns         : [],\n  columns_ids     : [],\n  visible_columns : [],\n\n\n  emitChange(event) {\n    this.emit(event);\n  },\n\n  addChangeListener(event, callback) {\n    this.on(event, callback);\n  },\n\n  removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  },\n\n  addColumns(c, id){\n    id   = id || _.uniqueId();\n    let cols = this.setTitles(c);\n    this.columns.push({id:id, cols:cols, visible:this.setVisibleColumns(cols)});\n    // console.log('columns', this.columns);\n    return id;\n  },\n\n  changeDevice(d){\n    this.device = (d) ? d : this.device;\n    this.columns = _.map(this.columns, (col)=>{\n      col.visible = this.setVisibleColumns(col.cols);\n      return col;\n    });\n\n  },\n\n  getDevice(){\n    return this.device;\n  },\n\n  getColumn(id){\n    let items;\n    if(id){\n      items =  _.find(this.columns, (col)=>{\n        return col.id === id;\n      });\n    } else {\n      items = _.first(this.columns);\n    }\n\n    if(items){\n      return items;\n    }\n\n    return {cols:[], visible:[]};\n  },\n\n  getDateColumns(id){\n    let column = this.getColumn(id).cols;\n    let dates = _.chain(column)\n      .filter((col)=>(col.type === \"date\" || col.type === \"dateTime\"))\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\", \"type\", \"fmt\"]))\n      .value();\n\n    return dates;\n  },\n\n  getHeadline(id){\n    return _.find(this.getColumn(id).visible, (col)=>{\n      return col.headline;\n    });\n  },\n\n  getKeys(id){\n    let visible = this.getColumn(id).visible;\n    return _.pluck(visible, \"key\");\n  },\n\n  getKeyAndTitle(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, (col)=> this.reduceObj(col, [\"key\", \"title\"]));\n  },\n\n  getLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return col.label;\n    });\n  },\n\n  getNonLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return _.isBoolean(col.label) && !col.label;\n    });\n  },\n\n  getSearchable(id){\n    let column = this.getColumn(id).cols;\n    let searchables = _.chain(column)\n      .filter((col)=>col.searchable)\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n\n    return searchables;\n  },\n\n  getShowable(id){\n    let column = this.getColumn(id);\n    let showables = _.chain(column.cols)\n      .filter((col)=>{\n        return col.show && !_.includes(column.visible, col);\n      })\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n    return showables;\n  },\n\n  getSortable(id){\n    let column = this.getColumn(id).cols;\n    let sortables = _.chain(column)\n      .filter((col)=>col.sortable)\n      .map((col)=> this.reduceObj(col, [\"key\", \"title\"]))\n      .value();\n\n    return sortables;\n  },\n\n  getTitles(id){\n    let visible = this.getColumn(id).visible;\n    return _.pluck(visible, \"title\");\n  },\n\n  getTitleForKey(key, id){\n    let column = this.getColumn(id).cols;\n    let item = _.find(column, (col)=> col.key === key );\n    return item.title;\n  },\n\n  getVisible(id){\n    return this.getColumn(id).visible;\n  },\n\n  reduceObj(obj, values){\n    let reduced = _.omit(obj, (v, k)=>{\n      return !_.includes(values, k);\n    });\n    return reduced;\n  },\n\n  removeCols(removeItems){\n    return _.reject(this.columns, (col)=>{\n      return _.includes(removeItems, col);\n    });\n  },\n\n  setVisibleColumns(cols){\n    let check = {};\n    check[this.device] = true;\n\n    return _.where(cols, check);\n  },\n\n  setTitles(columns){\n    columns = _.map(columns, function(col){\n      // console.log(that.capitalize)\n      if(!_.has(col, \"title\")){\n        let title = this.capitalize(col.key);\n        _.set(col, \"title\", title);\n      }\n\n      return col;\n    }.bind(this));\n\n    return columns;\n  }\n};\n\nObject.assign(store, textMixins);\n\n\nconst ColumnsStore = assign({}, EventEmitter.prototype, store);\n\nconst registeredCallback = function(payload) {\n  let action = payload.action;\n  switch(action.type) {\n    case \"ADDING_COLUMNS\":\n      ColumnsStore.addColumns(action.columns, action.id);\n      ColumnsStore.emitChange(\"adding\");\n      break;\n\n    case \"CHANGE_DEVICE\":\n      ColumnsStore.changeDevice(action.device);\n      ColumnsStore.emitChange(\"change\");\n      break;\n    }\n};\n\nColumnsStore.dispatchToken = ColumnsDispatcher.register(registeredCallback);\nColumnsStore.setMaxListeners(0);\n\nmodule.exports = ColumnsStore;\n"]}