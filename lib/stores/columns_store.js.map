{"version":3,"sources":["../../src/stores/columns_store.js"],"names":[],"mappings":"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","file":"columns_store.js","sourcesContent":["const EventEmitter  = require('events').EventEmitter;\n\nconst _    = require('lodash/core')\n    , includes = require('lodash/includes')\n    , pick = require('lodash/pick');\n\nconst textMixins = require('morse-react-mixins').text_mixins;\nconst ColumnsDispatcher = require('../dispatchers/columns_dispatcher');\n\nconst store = {\n  device: 'desktop'\n  , columns: []\n  , columns_ids: []\n  , visible_columns: []\n\n  , emitChange(event) {\n    this.emit(event);\n  }\n\n  , addChangeListener(event, callback) {\n    this.on(event, callback);\n  }\n\n  , removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  }\n\n  , addColumns(c, id){\n    id   = id || _.uniqueId();\n    let cols = this.setTitles(c);\n    this.columns.push({\n      id: id\n      , cols: cols\n      , visible: this.setVisibleColumns(cols)\n    });\n    return id;\n  }\n\n  , changeDevice(d){\n    this.device = (d) ? d : this.device;\n    this.columns = _.map(this.columns, (col)=>{\n      col.visible = this.setVisibleColumns(col.cols);\n      return col;\n    });\n  }\n\n  , getDevice(){\n    return this.device;\n  }\n\n  , getColumn(id){\n    let items;\n    if (id){\n      items =  _.find(this.columns, (col)=>{\n        return col.id === id;\n      });\n    } else {\n      items = _.first(this.columns);\n    }\n\n    if (items){\n      return items;\n    }\n\n    return {cols: [], visible: []};\n  }\n\n  , getDateColumns(id){\n    let column = this.getColumn(id).cols;\n    let dates = _.chain(column)\n      .filter((col)=>(col.type === 'date' || col.type === 'dateTime'))\n      .map((col)=>this.reduceObj(col, ['key', 'title', 'type', 'fmt']))\n      .value();\n\n    return dates;\n  }\n\n  , getHeadline(id){\n    return _.find(this.getColumn(id).visible, (col)=>{\n      return col.headline;\n    });\n  }\n\n  , getKeys(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, 'key');\n  }\n\n  , getKeyAndTitle(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, (col)=>this.reduceObj(col, ['key', 'title']));\n  }\n\n  , getLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return col.label;\n    });\n  }\n\n  , getNonLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return _.isBoolean(col.label) && !col.label;\n    });\n  }\n\n  , getSearchable(id){\n    let column = this.getColumn(id).cols;\n    let searchables = _.chain(column)\n      .filter((col)=>col.searchable)\n      .map((col)=>this.reduceObj(col, ['key', 'title']))\n      .value();\n\n    return searchables;\n  }\n\n  , getShowable(id){\n    let column = this.getColumn(id);\n    let showables = _.chain(column.cols)\n      .filter((col)=>{\n        return col.show && !includes(column.visible, col);\n      })\n      .map((col)=>this.reduceObj(col, ['key', 'title']))\n      .value();\n    return showables;\n  }\n\n  , getSortable(id){\n    let column = this.getColumn(id).cols;\n    let sortables = _.chain(column)\n      .filter((col)=>col.sortable)\n      .map((col)=>this.reduceObj(col, ['key', 'title']))\n      .value();\n\n    return sortables;\n  }\n\n  , getTitles(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, 'title');\n  }\n\n  , getTitleForKey(key, id){\n    let column = this.getColumn(id).cols;\n    let item = _.find(column, (col)=>col.key === key);\n    return item.title;\n  }\n\n  , getVisible(id){\n    return this.getColumn(id).visible;\n  }\n\n  , reduceObj(obj, values){\n    return pick(obj, values);\n  }\n\n  , removeCols(removeItems){\n    return _.reject(this.columns, (col)=>{\n      return includes(removeItems, col);\n    });\n  }\n\n  , setVisibleColumns(cols){\n    let check = {};\n    check[this.device] = true;\n\n    return _.filter(cols, (c)=>c[this.device]);\n  }\n\n  , setTitles(columns){\n    columns = _.map(columns, function(col){\n      if (!_.has(col, 'title')){\n        let title = this.capitalize(col.key);\n        col.title = title;\n      }\n\n      return col;\n    }.bind(this));\n\n    return columns;\n  }\n};\n\nObject.assign(store, textMixins);\n\nconst ColumnsStore = Object.assign({}, EventEmitter.prototype, store);\n\nconst registeredCallback = function(payload){\n  let action = payload.action;\n  /*eslint-disable*/\n  switch (action.type) {\n    case 'ADDING_COLUMNS':\n      ColumnsStore.addColumns(action.columns, action.id);\n      ColumnsStore.emitChange('adding');\n      break;\n\n    case 'CHANGE_DEVICE':\n      ColumnsStore.changeDevice(action.device);\n      ColumnsStore.emitChange('change');\n      break;\n    }\n  /*eslint-enable*/\n};\n\nColumnsStore.dispatchToken = ColumnsDispatcher.register(registeredCallback);\nColumnsStore.setMaxListeners(0);\n\nmodule.exports = ColumnsStore;\n"]}