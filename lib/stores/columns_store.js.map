{"version":3,"sources":["../../src/stores/columns_store.js"],"names":["EventEmitter","_","includes","text_mixins","textMixins","ColumnsDispatcher","store","device","columns","columns_ids","visible_columns","emitChange","event","emit","addChangeListener","callback","on","removeChangeListener","removeListener","addColumns","c","id","uniqueId","cols","setTitles","push","visible","setVisibleColumns","changeDevice","d","map","col","getDevice","getColumn","items","find","first","getDateColumns","column","dates","chain","filter","type","reduceObj","value","getHeadline","headline","getKeys","getKeyAndTitle","key","title","Object","getLabeled","label","getNonLabeled","isBoolean","getSearchable","searchables","searchable","getShowable","showables","show","obj","getSortable","sortables","sortable","getTitles","getTitleForKey","item","getVisible","values","reduce","newObj","v","removeCols","removeItems","reject","check","has","capitalize","bind","assign","ColumnsStore","prototype","registeredCallback","payload","action","dispatchToken","register","setMaxListeners"],"mappings":"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","file":"columns_store.js","sourcesContent":["import {EventEmitter as EventEmitter} from 'events';\nimport _ from 'lodash/core';\nimport includes from 'lodash/includes';\nimport {text_mixins as textMixins} from 'morse-react-mixins';\nimport ColumnsDispatcher from '../dispatchers/columns_dispatcher';\n\nconst store = {\n  device: 'desktop'\n  , columns: []\n  , columns_ids: []\n  , visible_columns: []\n\n  , emitChange(event) {\n    this.emit(event);\n  }\n\n  , addChangeListener(event, callback) {\n    this.on(event, callback);\n  }\n\n  , removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  }\n\n  , addColumns(c, id){\n    id   = id || _.uniqueId();\n    let cols = this.setTitles(c);\n    this.columns.push({\n      id: id\n      , cols: cols\n      , visible: this.setVisibleColumns(cols)\n    });\n    return id;\n  }\n\n  , changeDevice(d){\n    this.device = (d) ? d : this.device;\n    this.columns = _.map(this.columns, (col)=>{\n      col.visible = this.setVisibleColumns(col.cols);\n      return col;\n    });\n  }\n\n  , getDevice(){\n    return this.device;\n  }\n\n  , getColumn(id){\n    let items;\n    if (id){\n      items =  _.find(this.columns, (col)=>{\n        return col.id === id;\n      });\n    } else {\n      items = _.first(this.columns);\n    }\n\n    if (items){\n      return items;\n    }\n\n    return {cols: [], visible: []};\n  }\n\n  , getDateColumns(id){\n    let column = this.getColumn(id).cols;\n    let dates = _.chain(column)\n      .filter((col)=>(col.type === 'date' || col.type === 'dateTime'))\n      .map((col)=>this.reduceObj(col, ['key', 'title', 'type', 'fmt']))\n      .value();\n\n    return dates;\n  }\n\n  , getHeadline(id){\n    return _.find(this.getColumn(id).visible, (col)=>{\n      return col.headline;\n    });\n  }\n\n  , getKeys(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, 'key');\n  }\n\n  , getKeyAndTitle(id){\n    let visible = this.getColumn(id).visible;\n    return visible.map(({key, title})=>Object({key, title}));\n  }\n\n  , getLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return col.label;\n    });\n  }\n\n  , getNonLabeled(id){\n    return _.filter(this.getColumn(id).visible, (col)=>{\n      return _.isBoolean(col.label) && !col.label;\n    });\n  }\n\n  , getSearchable(id){\n    let column = this.getColumn(id).cols;\n    let searchables = _.chain(column)\n      .filter((col)=>col.searchable)\n      .map((col)=>this.reduceObj(col, ['key', 'title']))\n      .value();\n\n    return searchables;\n  }\n\n  , getShowable(id){\n    let column = this.getColumn(id);\n    let showables = _.chain(column.cols)\n      .filter((col)=>{\n\n        return col.show && !includes(column.visible, col);\n      })\n      .map((col)=>{\n        let obj = this.reduceObj(col, ['key', 'title']);\n        return obj;\n      })\n      .value();\n    return showables;\n  }\n\n  , getSortable(id){\n    let column = this.getColumn(id).cols;\n    let sortables = _.chain(column)\n      .filter((col)=>col.sortable)\n      .map((col)=>this.reduceObj(col, ['key', 'title']))\n      .value();\n\n    return sortables;\n  }\n\n  , getTitles(id){\n    let visible = this.getColumn(id).visible;\n    return _.map(visible, 'title');\n  }\n\n  , getTitleForKey(key, id){\n    let column = this.getColumn(id).cols;\n    let item = _.find(column, (col)=>col.key === key);\n    return item.title;\n  }\n\n  , getVisible(id){\n    return this.getColumn(id).visible;\n  }\n\n  , reduceObj(obj, values){\n    return values.reduce((newObj, v)=>{\n      newObj[v] = obj[v];\n      return newObj;\n    }, {});\n  }\n\n  , removeCols(removeItems){\n    return _.reject(this.columns, (col)=>{\n      return includes(removeItems, col);\n    });\n  }\n\n  , setVisibleColumns(cols){\n    let check = {};\n    check[this.device] = true;\n\n    return _.filter(cols, (c)=>c[this.device]);\n  }\n\n  , setTitles(columns){\n    columns = _.map(columns, function(col){\n      if (!_.has(col, 'title')){\n        let title = this.capitalize(col.key);\n        col.title = title;\n      }\n\n      return col;\n    }.bind(this));\n\n    return columns;\n  }\n};\n\nObject.assign(store, textMixins);\n\nconst ColumnsStore = Object.assign({}, EventEmitter.prototype, store);\n\nconst registeredCallback = function(payload){\n  let action = payload.action;\n  /*eslint-disable*/\n  switch (action.type) {\n    case 'ADDING_COLUMNS':\n      ColumnsStore.addColumns(action.columns, action.id);\n      ColumnsStore.emitChange('adding');\n      break;\n\n    case 'CHANGE_DEVICE':\n      ColumnsStore.changeDevice(action.device);\n      ColumnsStore.emitChange('change');\n      break;\n    }\n  /*eslint-enable*/\n};\n\nColumnsStore.dispatchToken = ColumnsDispatcher.register(registeredCallback);\nColumnsStore.setMaxListeners(0);\n\nexport default ColumnsStore;\n"]}