(function(global,factory){if('function'==typeof define&&define.amd)define(['exports','events','lodash','lodash/includes','morse-react-mixins','../dispatchers/columns_dispatcher'],factory);else if('undefined'!=typeof exports)factory(exports,require('events'),require('lodash'),require('lodash/includes'),require('morse-react-mixins'),require('../dispatchers/columns_dispatcher'));else{var mod={exports:{}};factory(mod.exports,global.events,global.lodash,global.includes,global.morseReactMixins,global.columns_dispatcher),global.columns_store=mod.exports}})(this,function(exports,_events,_lodash,_includes,_morseReactMixins,_columns_dispatcher){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,'__esModule',{value:!0});var _lodash2=_interopRequireDefault(_lodash),_includes2=_interopRequireDefault(_includes),_columns_dispatcher2=_interopRequireDefault(_columns_dispatcher),FilterMap=function(filter,map){return function(array){var newArray=array.filter(filter);return newArray.map(map)}},store={device:'desktop',columns:[],columns_ids:[],visible_columns:[],emitChange:function(event){this.emit(event)},addChangeListener:function(event,callback){this.on(event,callback)},removeChangeListener:function(event,callback){this.removeListener(event,callback)},addColumns:function(c,id){id=id||_lodash2.default.uniqueId();var cols=this.setTitles(c);return this.columns.push({id:id,cols:cols,visible:this.setVisibleColumns(cols)}),id},changeDevice:function(d){var _this=this;this.device=d?d:this.device,this.columns=_lodash2.default.map(this.columns,function(col){return col.visible=_this.setVisibleColumns(col.cols),col})},getDevice:function(){return this.device},getColumn:function(id){var items;return items=id?_lodash2.default.find(this.columns,function(col){return col.id===id}):_lodash2.default.first(this.columns),items?items:{cols:[],visible:[]}},getDateColumns:function(id){var _this2=this,column=this.getColumn(id).cols,filterCols=FilterMap(function(col){return'date'===col.type||'dateTime'===col.type},function(col){return _this2.reduceObj(col,['key','title','type','fmt'])});return filterCols(column)},getHeadline:function(id){return _lodash2.default.find(this.getColumn(id).visible,function(col){return col.headline})},getKeys:function(id){var visible=this.getColumn(id).visible;return _lodash2.default.map(visible,'key')},getKeyAndTitle:function(id){var visible=this.getColumn(id).visible;return visible.map(function(_ref){var key=_ref.key,title=_ref.title;return{key:key,title:title}})},getLabeled:function(id){return _lodash2.default.filter(this.getColumn(id).visible,function(col){return col.label})},getNonLabeled:function(id){return _lodash2.default.filter(this.getColumn(id).visible,function(col){return _lodash2.default.isBoolean(col.label)&&!col.label})},getSearchable:function(id){var _this3=this,column=this.getColumn(id).cols,searchables=column.filter(function(col){return col.searchable});return searchables.map(function(col){return _this3.reduceObj(col,['key','title'])})},getShowable:function(id){var _this4=this,column=this.getColumn(id),showables=column.cols.filter(function(col){return col.show&&!(0,_includes2.default)(column.visible,col)});return showables.map(function(col){return _this4.reduceObj(col,['key','title'])})},getSortable:function(id){var _this5=this,column=this.getColumn(id).cols,sortables=_lodash2.default.chain(column).filter(function(col){return col.sortable}).map(function(col){return _this5.reduceObj(col,['key','title'])}).value();return sortables},getTitles:function(id){var visible=this.getColumn(id).visible;return _lodash2.default.map(visible,'title')},getTitleForKey:function(key,id){var column=this.getColumn(id).cols,item=_lodash2.default.find(column,function(col){return col.key===key});return item.title},getVisible:function(id){return this.getColumn(id).visible},reduceObj:function(obj,values){return values.reduce(function(newObj,v){return newObj[v]=obj[v],newObj},{})},removeCols:function(removeItems){return _lodash2.default.reject(this.columns,function(col){return(0,_includes2.default)(removeItems,col)})},setVisibleColumns:function(cols){var _this6=this;return{}[this.device]=!0,_lodash2.default.filter(cols,function(c){return c[_this6.device]})},setTitles:function(columns){return columns=_lodash2.default.map(columns,function(col){if(!_lodash2.default.has(col,'title')){var title=this.capitalize(col.key);col.title=title}return col}.bind(this)),columns}};Object.assign(store,_morseReactMixins.text_mixins);var ColumnsStore=Object.assign({},_events.EventEmitter.prototype,store);ColumnsStore.dispatchToken=_columns_dispatcher2.default.register(function registeredCallback(payload){var action=payload.action;switch(action.type){case'ADDING_COLUMNS':ColumnsStore.addColumns(action.columns,action.id),ColumnsStore.emitChange('adding');break;case'CHANGE_DEVICE':ColumnsStore.changeDevice(action.device),ColumnsStore.emitChange('change');}}),ColumnsStore.setMaxListeners(0),exports.default=ColumnsStore});
//# sourceMappingURL=columns_store.js.map