{"version":3,"sources":["../../../src/components/nav/date_nav.js"],"names":[],"mappings":"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","file":"date_nav.js","sourcesContent":["// Libraries\nconst React = require('react')\n    , _     = require('lodash/core');\n_.take = require('lodash/take');\n_.mapValues = require('lodash/mapValues');\n_.reject = require('lodash/reject');\n\n// Utils\nconst checker = require('../../utils/day_checker');\n\n// Mixins\nconst cssMixins    = require('morse-react-mixins').css_mixins\n    , textMixins   = require('morse-react-mixins').text_mixins\n    , widthsMixins = require('morse-react-mixins').widths_mixins;\n\n// Flux\nconst SessionsActions = require('../../actions/sessions_actions')\n    , SessionsStore   = require('../../stores/sessions_store')\n    , ColumnsStore    = require('../../stores/columns_store');\n\nconst NavItem = require('./stateless/nav_item')\n    , TodayItem   = require('./stateless/today_nav_item');\n\nclass DateNav extends React.Component{\n  constructor(props){\n    let current, dates, today;\n    super(props);\n    dates = this._splitDates();\n    today = dates[0];\n    current = today.date;\n    this.pos = 0;\n    this.state = {\n      dates: dates[1]\n      , today: today\n      , current: current\n      , listWidth: 1000\n      , listPos: 0\n    };\n  }\n\n  componentDidMount(){\n    this.setState({listWidth: this._setWidth()});\n  }\n\n  componentDidUpdate(){\n    let holderWidth, listWidth;\n    holderWidth = document.querySelector('.list-holder').offsetWidth;\n    listWidth  = this._setWidth();\n    if (listWidth === this.state.listWidth){\n      let widths = this.state.listWidth + this.state.listPos;\n\n      if (holderWidth > widths){\n        SessionsActions.getMoreDays();\n      }\n    } else {\n      this.setState({listWidth: this._setWidth()});\n    }\n  }\n\n  componentWillMount(){\n    SessionsStore.addChangeListener('fetched', this._getDates.bind(this));\n    SessionsStore.addChangeListener('changing_date', this._getDates.bind(this));\n    SessionsStore.addChangeListener('calendar_changing'\n                                   , this._reset.bind(this)\n                                  );\n    ColumnsStore.addChangeListener('change', this._deviceChange.bind(this));\n  }\n\n  componentWillUnmount(){\n    SessionsStore.removeChangeListener('calendar_changing', this._reset);\n    SessionsStore.removeChangeListener('fetched', this._getDates);\n    SessionsStore.removeChangeListener('changing_date', this._getDates);\n    ColumnsStore.removeChangeListener('change', this._deviceChange);\n  }\n\n  _deviceChange(){\n    this.setState({\n      listWidth: this._setWidth()\n      , device: ColumnsStore.getDevice()\n    });\n  }\n\n  _getDates(){\n    let dates, today;\n    dates = this._splitDates();\n    today = dates[0];\n    if (!_.isDate(today.date) || !_.isDate(SessionsStore._getCurrentDate())){\n      alert(today.date + ' : ' + SessionsStore._getCurrentDate());\n    }\n    this.setState({\n      dates: dates[1]\n      , today: today\n      , listWidth: this._setWidth()\n      , current: SessionsStore._getCurrentDate()\n    });\n  }\n\n  _getDistance(move){\n    if (_.isEmpty(move)) return 0;\n\n    return _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _getPrevious(pos){\n    if (pos >= 0){\n      let firstDate, tomorrow;\n      tomorrow = _.clone(this.state.today.date);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      firstDate = _.first(this.state.dates).date;\n      if (!checker(tomorrow, firstDate)){\n        SessionsActions.getPreviousDays(firstDate);\n      }\n    }\n  }\n\n  _mover(dir, e){\n    let elms, move, mover;\n    e.preventDefault();\n    elms = this.getAllWidths();\n    if (dir === 'left' && this.pos > 0){\n      this.pos--;\n    } else if ((dir === 'right' && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    move  = _.map(_.take(elms, this.pos), 'width');\n    mover = -this._getDistance(move);\n    this.setState({listPos: mover});\n    this._getPrevious(mover);\n  }\n\n  _setCurrent(date, e){\n    e.preventDefault();\n    SessionsActions.changeDate(date);\n    this.setState({current: date});\n  }\n\n  _setActive(date){\n    return (checker(date, this.state.current)) ? 'active' : '';\n  }\n\n  _setStyle(){\n    let styles = {\n      width: this.state.listWidth\n      , left: this.state.listPos\n    };\n\n    return _.mapValues(styles, (v)=>{\n      return v;\n    });\n  }\n\n  _setWidth(){\n    this.convertDomlist(this.refs.datelist.querySelectorAll('li'));\n    return Math.ceil(this.getWidths());\n  }\n\n  _splitDates(){\n    let dates = SessionsStore._getAllDates();\n    return [_.find(dates, (d)=>d.today), _.reject(dates, (d)=>d.today)];\n  }\n\n  _reset(){\n    this.setState({listPos: 0});\n  }\n\n  _renderDates(){\n    if (this.state.dates.length){\n      return _.map(this.state.dates, (d)=>{\n        let key = this.createId(d.title, d.date.getDate(), d.date.getMonth());\n        return (<NavItem\n            key      = {key}\n            nav_item = {d}\n            device   = {this.state.device}\n            onClick  = {this._setCurrent.bind(this, d.date)}\n            active   = {this._setActive(d.date)}\n          />);\n      });\n    }\n\n    return [];\n  }\n\n  _renderToday(){\n    let key, today;\n    today = this.state.today;\n    key = this.createId(today.title\n      , today.date.getDate()\n      , today.date.getMonth()\n    );\n    return (\n     <TodayItem\n        key      = {key}\n        nav_item = {today}\n        device   = {this.state.device}\n        onClick  = {this._setCurrent.bind(this, today.date)}\n        active   = {this._setActive(today.date)}\n      />\n    );\n  }\n\n  render(){\n    return (\n      <nav className=\"date-nav\">\n      <a href=\"#\"\n         className=\"nav-mover move-left\"\n         onClick={this._mover.bind(this, 'left')}\n      >\n        <span className=\"hidden\">left</span>\n      </a>\n      {this._renderToday()}\n      <div className=\"list-holder\">\n        <ul className=\"date-list\"\n            role=\"tablist\"\n            ref=\"datelist\"\n            style={this._setStyle()}>\n          {this._renderDates()}\n        </ul>\n      </div>\n      <a href=\"#\"\n         className=\"nav-mover move-right\"\n         onClick={this._mover.bind(this, 'right')}\n      >\n        <span className=\"hidden\">right</span>\n      </a>\n      </nav>\n    );\n  }\n\n}\n\nObject.assign(DateNav.prototype, cssMixins);\nObject.assign(DateNav.prototype, textMixins);\nObject.assign(DateNav.prototype, widthsMixins);\n\nmodule.exports = DateNav;\n"]}