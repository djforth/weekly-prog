{"version":3,"sources":["../../../src/components/nav/date_nav.js"],"names":[],"mappings":"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","file":"date_nav.js","sourcesContent":["// Libraries\nconst React = require('react')\n    , _     = require('lodash/core');\n_.take = require('lodash/take');\n_.mapValues = require('lodash/mapValues');\n_.reject = require('lodash/reject');\n\n// Utils\nconst checker = require('../../utils/day_checker');\n\n// Mixins\nconst cssMixins    = require('morse-react-mixins').css_mixins\n    , textMixins   = require('morse-react-mixins').text_mixins\n    , widthsMixins = require('morse-react-mixins').widths_mixins;\n\n// Flux\nconst SessionsActions = require('../../actions/sessions_actions')\n    , SessionsStore   = require('../../stores/sessions_store')\n    , ColumnsStore    = require('../../stores/columns_store');\n\nconst NavItem = require('./stateless/nav_item')\n    , TodayItem   = require('./stateless/today_nav_item');\n\nclass DateNav extends React.Component{\n  constructor(props){\n    let current, dates, today;\n    super(props);\n    dates = this._splitDates();\n    today = dates[0];\n    current = today.date;\n    this.pos = 0;\n    this.state = {\n      dates: dates[1]\n      , today: today\n      , current: current\n      , listWidth: 1000\n      , listPos: 0\n    };\n  }\n\n  componentDidMount(){\n    this.setState({listWidth: this._setWidth()});\n  }\n\n  componentDidUpdate(){\n    let holderWidth, listWidth;\n    holderWidth = document.querySelector('.list-holder').offsetWidth;\n    listWidth  = this._setWidth();\n    if (listWidth === this.state.listWidth){\n      let widths = this.state.listWidth + this.state.listPos;\n\n      if (holderWidth > widths){\n        SessionsActions.getMoreDays();\n      }\n    } else {\n      this.setState({listWidth: this._setWidth()});\n    }\n  }\n\n  componentWillMount(){\n    SessionsStore.addChangeListener('fetched', this._getDates.bind(this));\n    SessionsStore.addChangeListener('changing_date', this._getDates.bind(this));\n    SessionsStore.addChangeListener('calendar_changing'\n                                   , this._reset.bind(this)\n                                  );\n    ColumnsStore.addChangeListener('change', this._deviceChange.bind(this));\n  }\n\n  componentWillUnmount(){\n    SessionsStore.removeChangeListener('calendar_changing', this._reset);\n    SessionsStore.removeChangeListener('fetched', this._getDates);\n    SessionsStore.removeChangeListener('changing_date', this._getDates);\n    ColumnsStore.removeChangeListener('change', this._deviceChange);\n  }\n\n  _deviceChange(){\n    this.setState({\n      listWidth: this._setWidth()\n      , device: ColumnsStore.getDevice()\n    });\n  }\n\n  _getDates(){\n    let dates, today;\n    dates = this._splitDates();\n    today = dates[0];\n    if (!_.isDate(today.date) || !_.isDate(SessionsStore._getCurrentDate())){\n      alert(today.date + ' : ' + SessionsStore._getCurrentDate());\n    }\n    this.setState({\n      dates: dates[1]\n      , today: today\n      , listWidth: this._setWidth()\n      , current: SessionsStore._getCurrentDate()\n    });\n  }\n\n  _getDistance(move){\n    if (_.isEmpty(move)) return 0;\n\n    return _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _getPrevious(pos){\n    if (pos >= 0){\n      let firstDate, tomorrow;\n      tomorrow = _.clone(this.state.today.date);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      firstDate = _.first(this.state.dates).date;\n      if (!checker(tomorrow, firstDate)){\n        SessionsActions.getPreviousDays(firstDate);\n      }\n    }\n  }\n\n  _mover(dir, e){\n    let elms, move, mover;\n    e.preventDefault();\n    elms = this.getAllWidths();\n    if (dir === 'left' && this.pos > 0){\n      this.pos--;\n    } else if ((dir === 'right' && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    move  = _.map(_.take(elms, this.pos), 'width');\n    mover = -this._getDistance(move);\n    this.setState({listPos: mover});\n    this._getPrevious(mover);\n  }\n\n  _setCurrent(date, e){\n    e.preventDefault();\n    SessionsActions.changeDate(date);\n    this.setState({current: date});\n  }\n\n  _setActive(date){\n    return (checker(date, this.state.current)) ? 'active' : '';\n  }\n\n  _setStyle(){\n    let styles = {\n      width: this.state.listWidth\n      , left: this.state.listPos\n    };\n\n    return _.mapValues(styles, (v)=>{\n      return v;\n    });\n  }\n\n  _setWidth(){\n    this.convertDomlist(this.refs.datelist.querySelectorAll('li'));\n    return Math.ceil(this.getWidths());\n  }\n\n  _splitDates(){\n    let dates = SessionsStore._getAllDates();\n    return [_.find(dates, (d)=>d.today), _.reject(dates, (d)=>d.today)];\n  }\n\n  _reset(){\n    this.setState({listPos: 0});\n  }\n\n  _renderDates(){\n    if (this.state.dates.length){\n      return _.map(this.state.dates, (d)=>{\n        let key = this.createId(d.title, d.date.getDate(), d.date.getMonth());\n        return (<NavItem\n            key      = {key}\n            nav_item = {d}\n            device   = {this.state.device}\n            onClick  = {this._setCurrent.bind(this, d.date)}\n            active   = {this._setActive(d.date)}\n          />);\n      });\n    }\n\n    return [];\n  }\n\n  _renderToday(){\n    let key, today;\n    today = this.state.today;\n    key = this.createId(today.title\n      , today.date.getDate()\n      , today.date.getMonth()\n    );\n    return (\n     <TodayItem\n        key      = {key}\n        nav_item = {today}\n        device   = {this.state.device}\n        onClick  = {this._setCurrent.bind(this, today.date)}\n        active   = {this._setActive(today.date)}\n      />\n    );\n  }\n\n  render(){\n    return (\n      <nav className=\"date-nav\">\n      <a href=\"#\"\n         className=\"nav-mover move-left\"\n         onClick={this._mover.bind(this, 'left')}\n      >\n        <span className=\"hidden\">left</span>\n      </a>\n      {this._renderToday()}\n      <div className=\"list-holder\">\n        <ul className=\"date-list\"\n            role=\"tablist\"\n            ref=\"datelist\"\n            style={this._setStyle()}>\n          {this._renderDates()}\n        </ul>\n      </div>\n      <a href=\"#\"\n         className=\"nav-mover move-right\"\n         onClick={this._mover.bind(this, 'right')}\n      >\n        <span className=\"hidden\">right</span>\n      </a>\n      </nav>\n    );\n  }\n\n}\n\nObject.assign(DateNav.prototype, cssMixins);\nObject.assign(DateNav.prototype, textMixins);\nObject.assign(DateNav.prototype, widthsMixins);\n\nmodule.exports = DateNav;"]}