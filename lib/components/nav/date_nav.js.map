{"version":3,"sources":["../../../src/components/nav/date_nav.jsx"],"names":["take","mapValues","reject","DateNav","props","current","dates","today","_splitDates","date","dateList","pos","state","listWidth","listPos","setState","_setWidth","holderWidth","document","querySelector","offsetWidth","widths","getMoreDays","addChangeListener","_getDates","bind","_reset","_deviceChange","removeChangeListener","device","getDevice","isDate","_getCurrentDate","alert","move","isEmpty","reduce","prev","cur","firstDate","tomorrow","clone","setDate","getDate","first","getPreviousDays","dir","e","elms","mover","preventDefault","getAllWidths","length","map","_getDistance","_getPrevious","changeDate","styles","width","left","v","convertDomlist","querySelectorAll","Math","ceil","getWidths","_getAllDates","find","d","key","createId","title","getMonth","_setCurrent","_setActive","_mover","_renderToday","console","log","_setStyle","_renderDates","Component","Object","assign","prototype"],"mappings":"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","file":"date_nav.js","sourcesContent":["// Libraries\n\nimport React from 'react';\n\nimport _ from 'lodash';\nimport take from 'lodash/take';\n _.take = take;\nimport mapValues from 'lodash/mapValues';\n _.mapValues = mapValues;\nimport reject from 'lodash/reject';\n _.reject = reject;\n\n// Utils\nimport checker from '../../utils/day_checker';\n\n// Mixins\nimport {\n  css_mixins as cssMixins\n  , text_mixins as textMixins\n  , widths_mixins as widthsMixins\n} from 'morse-react-mixins';\n\n// Flux\nimport SessionsActions from '../../actions/sessions_actions';\nimport SessionsStore from '../../stores/sessions_store';\nimport ColumnsStore from '../../stores/columns_store';\n\nimport ArrowLeft from './stateless/arrow_left';\nimport ArrowRight from './stateless/arrow_right';\nimport NavItem from './stateless/nav_item';\nimport TodayItem from './stateless/today_nav_item';\n\nclass DateNav extends React.Component{\n  constructor(props){\n    let current, dates, today;\n    super(props);\n    dates = this._splitDates();\n    today = dates[0];\n    current = today.date;\n    this.dateList = null;\n    this.pos = 0;\n    this.state = {\n      dates: dates[1]\n      , today: today\n      , current: current\n      , listWidth: 1000\n      , listPos: 0\n    };\n  }\n\n  componentDidMount(){\n    this.setState({listWidth: this._setWidth()});\n  }\n\n  componentDidUpdate(){\n    let holderWidth, listWidth;\n    holderWidth = document.querySelector('.list-holder').offsetWidth;\n    listWidth  = this._setWidth();\n    if (listWidth === this.state.listWidth){\n      let widths = this.state.listWidth + this.state.listPos;\n\n      if (holderWidth > widths){\n        SessionsActions.getMoreDays();\n      }\n    } else {\n      this.setState({listWidth: this._setWidth()});\n    }\n  }\n\n  componentWillMount(){\n    SessionsStore.addChangeListener('fetched', this._getDates.bind(this));\n    SessionsStore.addChangeListener('changing_date', this._getDates.bind(this));\n    SessionsStore.addChangeListener('calendar_changing'\n                                   , this._reset.bind(this)\n                                  );\n    ColumnsStore.addChangeListener('change', this._deviceChange.bind(this));\n  }\n\n  componentWillUnmount(){\n    SessionsStore.removeChangeListener('calendar_changing', this._reset);\n    SessionsStore.removeChangeListener('fetched', this._getDates);\n    SessionsStore.removeChangeListener('changing_date', this._getDates);\n    ColumnsStore.removeChangeListener('change', this._deviceChange);\n  }\n\n  _deviceChange(){\n    this.setState({\n      listWidth: this._setWidth()\n      , device: ColumnsStore.getDevice()\n    });\n  }\n\n  _getDates(){\n    let dates, today;\n    dates = this._splitDates();\n    today = dates[0];\n    if (!_.isDate(today.date) || !_.isDate(SessionsStore._getCurrentDate())){\n      alert(today.date + ' : ' + SessionsStore._getCurrentDate());\n    }\n    this.setState({\n      dates: dates[1]\n      , today: today\n      , listWidth: this._setWidth()\n      , current: SessionsStore._getCurrentDate()\n    });\n  }\n\n  _getDistance(move){\n    if (_.isEmpty(move)) return 0;\n\n    return _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _getPrevious(pos){\n    if (pos >= 0){\n      let firstDate, tomorrow;\n      tomorrow = _.clone(this.state.today.date);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      firstDate = _.first(this.state.dates).date;\n      if (!checker(tomorrow, firstDate)){\n        SessionsActions.getPreviousDays(firstDate);\n      }\n    }\n  }\n\n  _mover(dir, e){\n    let elms, move, mover;\n    e.preventDefault();\n    elms = this.getAllWidths();\n    if (dir === 'left' && this.pos > 0){\n      this.pos--;\n    } else if ((dir === 'right' && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    move  = _.map(_.take(elms, this.pos), 'width');\n    mover = -this._getDistance(move);\n    this.setState({listPos: mover});\n    this._getPrevious(mover);\n  }\n\n  _setCurrent(date, e){\n    e.preventDefault();\n    SessionsActions.changeDate(date);\n    this.setState({current: date});\n  }\n\n  _setActive(date){\n    return (checker(date, this.state.current)) ? 'active' : '';\n  }\n\n  _setStyle(){\n    let styles = {\n      width: this.state.listWidth\n      , left: this.state.listPos\n    };\n    return _.mapValues(styles, (v)=>{\n      return v;\n    });\n  }\n\n  _setWidth(){\n    this.convertDomlist(this.dateList.querySelectorAll('li'));\n    return Math.ceil(this.getWidths());\n  }\n\n  _splitDates(){\n    let dates = SessionsStore._getAllDates();\n    return [_.find(dates, (d)=>d.today), _.reject(dates, (d)=>d.today)];\n  }\n\n  _reset(){\n    this.setState({listPos: 0});\n  }\n\n  _renderDates(){\n    if (this.state.dates.length){\n      return _.map(this.state.dates, (d)=>{\n        let key = this.createId(d.title, d.date.getDate(), d.date.getMonth());\n        return (<NavItem\n            key      = {key}\n            nav_item = {d}\n            device   = {this.state.device}\n            onClick  = {this._setCurrent.bind(this, d.date)}\n            active   = {this._setActive(d.date)}\n          />);\n      });\n    }\n\n    return [];\n  }\n\n  _renderToday(){\n    let key, today;\n    today = this.state.today;\n    key = this.createId(today.title\n      , today.date.getDate()\n      , today.date.getMonth()\n    );\n    return (\n     <TodayItem\n        key      = {key}\n        nav_item = {today}\n        device   = {this.state.device}\n        onClick  = {this._setCurrent.bind(this, today.date)}\n        active   = {this._setActive(today.date)}\n      />\n    );\n  }\n\n  render(){\n    return (\n      <nav className=\"date-nav\">\n        <ArrowLeft onClick={this._mover.bind(this, 'left')}/>\n        {this._renderToday()}\n        <div className=\"list-holder\">\n          <ul className=\"date-list\"\n              role=\"tablist\"\n              ref= {(e)=>{\n                console.log('target', e);\n                this.dateList = e;\n              }}\n              style={this._setStyle()}>\n            {this._renderDates()}\n          </ul>\n        </div>\n        <ArrowRight onClick={this._mover.bind(this, 'right')}/>\n      </nav>\n    );\n  }\n}\n\nObject.assign(DateNav.prototype, cssMixins);\nObject.assign(DateNav.prototype, textMixins);\nObject.assign(DateNav.prototype, widthsMixins);\n\nexport default DateNav;\n"]}