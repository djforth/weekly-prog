(function(global,factory){if('function'==typeof define&&define.amd)define(['exports','react','lodash','../../utils/day_checker','morse-react-mixins','../../actions/sessions_actions','../../stores/sessions_store','../../stores/columns_store','./stateless/nav_item','./stateless/today_nav_item'],factory);else if('undefined'!=typeof exports)factory(exports,require('react'),require('lodash'),require('../../utils/day_checker'),require('morse-react-mixins'),require('../../actions/sessions_actions'),require('../../stores/sessions_store'),require('../../stores/columns_store'),require('./stateless/nav_item'),require('./stateless/today_nav_item'));else{var mod={exports:{}};factory(mod.exports,global.react,global.lodash,global.day_checker,global.morseReactMixins,global.sessions_actions,global.sessions_store,global.columns_store,global.nav_item,global.today_nav_item),global.date_nav=mod.exports}})(this,function(exports,_react,_lodash,_day_checker,_morseReactMixins,_sessions_actions,_sessions_store,_columns_store,_nav_item,_today_nav_item){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,'__esModule',{value:!0});var _react2=_interopRequireDefault(_react),_lodash2=_interopRequireDefault(_lodash),_day_checker2=_interopRequireDefault(_day_checker),_sessions_actions2=_interopRequireDefault(_sessions_actions),_sessions_store2=_interopRequireDefault(_sessions_store),_columns_store2=_interopRequireDefault(_columns_store),_nav_item2=_interopRequireDefault(_nav_item),_today_nav_item2=_interopRequireDefault(_today_nav_item),_createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();_lodash2.default.take=_lodash.take,_lodash2.default.mapValues=_lodash.mapValues,_lodash2.default.reject=_lodash.reject;var DateNav=function(_React$Component){function DateNav(props){_classCallCheck(this,DateNav);var current,dates,today,_this=_possibleConstructorReturn(this,(DateNav.__proto__||Object.getPrototypeOf(DateNav)).call(this,props));return dates=_this._splitDates(),today=dates[0],current=today.date,_this.pos=0,_this.state={dates:dates[1],today:today,current:current,listWidth:1e3,listPos:0},_this}return _inherits(DateNav,_React$Component),_createClass(DateNav,[{key:'componentDidMount',value:function(){this.setState({listWidth:this._setWidth()})}},{key:'componentDidUpdate',value:function(){var holderWidth,listWidth;if(holderWidth=document.querySelector('.list-holder').offsetWidth,listWidth=this._setWidth(),listWidth===this.state.listWidth){var widths=this.state.listWidth+this.state.listPos;holderWidth>widths&&_sessions_actions2.default.getMoreDays()}else this.setState({listWidth:this._setWidth()})}},{key:'componentWillMount',value:function(){_sessions_store2.default.addChangeListener('fetched',this._getDates.bind(this)),_sessions_store2.default.addChangeListener('changing_date',this._getDates.bind(this)),_sessions_store2.default.addChangeListener('calendar_changing',this._reset.bind(this)),_columns_store2.default.addChangeListener('change',this._deviceChange.bind(this))}},{key:'componentWillUnmount',value:function(){_sessions_store2.default.removeChangeListener('calendar_changing',this._reset),_sessions_store2.default.removeChangeListener('fetched',this._getDates),_sessions_store2.default.removeChangeListener('changing_date',this._getDates),_columns_store2.default.removeChangeListener('change',this._deviceChange)}},{key:'_deviceChange',value:function(){this.setState({listWidth:this._setWidth(),device:_columns_store2.default.getDevice()})}},{key:'_getDates',value:function(){var dates,today;dates=this._splitDates(),today=dates[0],_lodash2.default.isDate(today.date)&&_lodash2.default.isDate(_sessions_store2.default._getCurrentDate())||alert(today.date+' : '+_sessions_store2.default._getCurrentDate()),this.setState({dates:dates[1],today:today,listWidth:this._setWidth(),current:_sessions_store2.default._getCurrentDate()})}},{key:'_getDistance',value:function(move){return _lodash2.default.isEmpty(move)?0:_lodash2.default.reduce(move,function(prev,cur){return prev+cur})}},{key:'_getPrevious',value:function(pos){if(0<=pos){var firstDate,tomorrow;tomorrow=_lodash2.default.clone(this.state.today.date),tomorrow.setDate(tomorrow.getDate()+1),firstDate=_lodash2.default.first(this.state.dates).date,(0,_day_checker2.default)(tomorrow,firstDate)||_sessions_actions2.default.getPreviousDays(firstDate)}}},{key:'_mover',value:function(dir,e){var elms,move,mover;e.preventDefault(),elms=this.getAllWidths(),'left'===dir&&0<this.pos?this.pos--:'right'===dir&&this.pos<elms.length&&this.pos++,move=_lodash2.default.map(_lodash2.default.take(elms,this.pos),'width'),mover=-this._getDistance(move),this.setState({listPos:mover}),this._getPrevious(mover)}},{key:'_setCurrent',value:function(date,e){e.preventDefault(),_sessions_actions2.default.changeDate(date),this.setState({current:date})}},{key:'_setActive',value:function(date){return(0,_day_checker2.default)(date,this.state.current)?'active':''}},{key:'_setStyle',value:function(){var styles={width:this.state.listWidth,left:this.state.listPos};return console.log(styles),_lodash2.default.mapValues(styles,function(v){return v})}},{key:'_setWidth',value:function(){return this.convertDomlist(this.refs.datelist.querySelectorAll('li')),Math.ceil(this.getWidths())}},{key:'_splitDates',value:function(){var dates=_sessions_store2.default._getAllDates();return[_lodash2.default.find(dates,function(d){return d.today}),_lodash2.default.reject(dates,function(d){return d.today})]}},{key:'_reset',value:function(){this.setState({listPos:0})}},{key:'_renderDates',value:function(){var _this2=this;return this.state.dates.length?_lodash2.default.map(this.state.dates,function(d){var key=_this2.createId(d.title,d.date.getDate(),d.date.getMonth());return _react2.default.createElement(_nav_item2.default,{key:key,nav_item:d,device:_this2.state.device,onClick:_this2._setCurrent.bind(_this2,d.date),active:_this2._setActive(d.date)})}):[]}},{key:'_renderToday',value:function(){var key,today;return today=this.state.today,key=this.createId(today.title,today.date.getDate(),today.date.getMonth()),_react2.default.createElement(_today_nav_item2.default,{key:key,nav_item:today,device:this.state.device,onClick:this._setCurrent.bind(this,today.date),active:this._setActive(today.date)})}},{key:'render',value:function(){return _react2.default.createElement('nav',{className:'date-nav'},_react2.default.createElement('a',{href:'#',className:'nav-mover move-left',onClick:this._mover.bind(this,'left')},_react2.default.createElement('span',{className:'hidden'},'left')),this._renderToday(),_react2.default.createElement('div',{className:'list-holder'},_react2.default.createElement('ul',{className:'date-list',role:'tablist',ref:'datelist',style:this._setStyle()},this._renderDates())),_react2.default.createElement('a',{href:'#',className:'nav-mover move-right',onClick:this._mover.bind(this,'right')},_react2.default.createElement('span',{className:'hidden'},'right')))}}]),DateNav}(_react2.default.Component);Object.assign(DateNav.prototype,_morseReactMixins.css_mixins),Object.assign(DateNav.prototype,_morseReactMixins.text_mixins),Object.assign(DateNav.prototype,_morseReactMixins.widths_mixins),exports.default=DateNav});