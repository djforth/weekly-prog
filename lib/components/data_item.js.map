{"version":3,"sources":["../../src/components/data_item.js"],"names":[],"mappings":"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","file":"data_item.js","sourcesContent":["const React = require(\"react\")\n    , _     = require(\"lodash/core\");\n\nconst ColumnsStore   = require(\"../stores/columns_store\");\n\nconst timeChecker = require(\"../utils/time_checker\")\n    , formatter   = require(\"../utils/formatter\");\n\n//Mixins\nlet mixins = require(\"morse-react-mixins\");\nconst [cssMixins, textMixins]  = [mixins.css_mixins, mixins.text_mixins];\n\nclass DataItem extends React.Component {\n  constructor(props) {\n    super(props);\n    this.active = [{active:false}];\n    // this._select.bind(this);\n    this.formatter = formatter(this.props.data)\n    this.state = {data:this.props.data, columns:[], datefield:[]};\n\n  }\n\n  componentWillMount() {\n    this.mounted = true;\n    this.setState({data:this.props.data, columns:ColumnsStore.getVisible()});\n    ColumnsStore.addChangeListener(\"change\", this._onChange.bind(this));\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    ColumnsStore.removeChangeListener(\"change\", this._onChange);\n  }\n\n  _nobooking(){\n    return (<span className=\"session-full\">No booking required</span>);\n  }\n\n  _actions(col){\n    let item = this.props.data;\n    let places = item.get(\"places_left\");\n    if(_.isNumber(places) && places === 0){\n      return(<span className=\"session-full\">Session full</span>);\n    }\n\n    if(item.has(\"buttons\") && item.get(\"buttons\").has(\"book\")){\n      let link = item.get(\"buttons\").get(\"book\")\n      return (link === \"#\" || _.isEmpty(link)) ? this._nobooking() : (<a className=\"button button-secondary\" href={link}>Book</a>);\n    }\n\n    return this._nobooking();\n  }\n\n  _onChange(){\n    if(this.mounted){\n      this.setState({\n        columns:ColumnsStore.getVisible()\n      });\n    }\n  }\n\n  _rawMarkup(data) {\n    return <span dangerouslySetInnerHTML={ {__html: data} } />;\n  }\n\n  _renderColumn(col, item){\n    return (\n      <div className={this.checkCss(this.props.css, col.key)} key={_.uniqueId(\"dataItem\")}>\n        {this._wrapper(item, col)}\n      </div>\n    );\n  }\n\n  _renderTd(){\n    let item = this.props.data;\n    if(item && this.state.columns){\n       let td = _.map(this.state.columns, function(col){\n\n         return this._renderColumn(col, item);\n      }.bind(this));\n\n      return td;\n    }\n    return \"\";\n  }\n\n  _setCss(item, col){\n\n    if(!col.type === \"time\" || _.isUndefined(col.concat)) return col.wrapper;\n\n    let checker = timeChecker(item, col);\n    return `${col.wrapper} ${checker.setNowOrPast(\"now\", \"past\")}`;\n  }\n\n  _showValues(col){\n    if(col.key === \"actions\") return this._actions(col);\n\n    let value = this.formatter(col);\n    if(_.isString(value) && value.match(/<|>/g)) return this._rawMarkup(value);\n    if(col.type !== \"time\") return value;\n    let checker = timeChecker(this.props.data, col);\n    let time = checker.setNowOrPast(\"This session has started\", \"This session has finished\", `This sessions runs between ${value}`);\n    return <span title={time}>{value}</span>;\n  }\n\n  _wrapper(item, col){\n    if(_.has(col, \"wrapper\")){\n      return (\n        <div className={this._setCss(item, col)}>\n          {this._showValues(col)}\n        </div>);\n    }\n\n    return this._showValues(col);\n  }\n\n\n  render() {\n    return (\n      <div className=\"row tr vPad5\">\n        {this._renderTd()}\n      </div>\n    );\n  }\n\n\n}\n\nObject.assign(DataItem.prototype, cssMixins);\nObject.assign(DataItem.prototype, textMixins);\n\nmodule.exports = DataItem;\n"]}